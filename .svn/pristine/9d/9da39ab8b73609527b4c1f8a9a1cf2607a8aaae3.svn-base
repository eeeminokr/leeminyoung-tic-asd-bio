<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Survey">
	<resultMap id="surveyMenuList" type="SurveyVO">
		<result property="docId" 			column="DOC_ID"/>
		<result property="docNm" 			column="DOC_NM"/>
		<result property="disClassDtl" 		column="DIS_CLASS_DTL"/>
		<result property="docClassDtl" 		column="DOC_CLASS_DTL"/>
		<result property="docHeader" 		column="DOC_HEADER"/>
	</resultMap>
	
	<resultMap id="surveyDtlList" type="SurveyVO">
		<result property="rownum"           column="ROWNUM"/>
		<result property="targetId"         column="TARGET_ID"/>
		<result property="targetDisId"      column="TARGET_DIS_ID"/>
		<result property="disClassDtl" 		column="DIS_CLASS_DTL"/>
		<result property="sex"              column="SEX"/>                                                                                 
		<result property="protocol"        	column="PROTOCOL"/>                                                                            
		<result property="performCnt"       column="PERFORM_CNT"/>
		<result property="performNm"       	column="PERFORM_NM"/>
		<result property="age"              column="AGE"/>
		<result property="execDate"         column="EXEC_DATE"/>
		<result property="docId"            column="DOC_ID"/>
		<result property="rndId"            column="RND_ID"/>
		<result property="choiceAnswer"     column="CHOICE_ANSWER"/>
		<result property="subjectAnswer"    column="SUBJECT_ANSWER"/>
		<result property="score"            column="SCORE"/>
		<result property="status"           column="STATUS"/>
		<result property="remarks"          column="REMARKS"/>
	</resultMap>
	
	<resultMap id="surveyTotalList" type="SurveyTotalVO">
		<result property="targetId"         column="TARGET_ID"/>
		<result property="targetDisId"      column="TARGET_DIS_ID"/>
		<result property="sex"              column="SEX"/>                                                                                 
		<result property="protocol"        	column="PROTOCOL"/>
		<result property="disClassDtl" 		column="DIS_CLASS_DTL"/>   
		<result property="classCdDtlNm"     column="CLASS_CD_DTL_NM"/>                                                                            
		<result property="performCnt"       column="PERFORM_CNT"/>
		<result property="performNm"       	column="PERFORM_NM"/>
		<result property="age"              column="AGE"/>
		<result property="visitDate"       	column="VISIT_DATE"/>
		<result property="docId"            column="DOC_ID"/>
		<result property="cvCgis"         	column="CV_CGI_S"/>
		<result property="cvCgii"           column="CV_CGI_I"/>
		<result property="cvCgas"    		column="CV_C_GAS"/>
		<result property="iv4Cgis"    		column="IV4_CGI_S"/>
		<result property="iv4Cgii"          column="IV4_CGI_I"/>
		<result property="iv4Cgas"          column="IV4_C_GAS"/>
		<result property="pillCntUsed"          column="PILL_CNT_USED"/>
		<result property="pillCntKind"          column="PILL_CNT_KIND"/>
		<result property="pillCntTotal"         column="PILL_CNT_TOTAL"/>
		<result property="pillCntEaten"         column="PILL_CNT_EATEN"/>
		<result property="ars01"				column="ARS01"/>
		<result property="kcbcl"				column="KCBCL"/>
		<result property="cbcl1"				column="CBCL1"/>
		<result property="dbds1"				column="DBDS1"/>
		<result property="cmrsp"				column="CMRSP"/>
		<result property="traum"				column="TRAUM"/>
		<result property="cdi01"				column="CDI01"/>
		<result property="iat01"				column="IAT01"/>
		<result property="kscal"				column="KSCAL"/>
		<result property="rcmas"				column="RCMAS"/>
		<result property="stitc"				column="STITC"/>
		<result property="stisc"				column="STISC"/>
		<result property="stity"				column="STITY"/>
		<result property="stisy"				column="STISY"/>
		<result property="loicv"				column="LOICV"/>
		<result property="kbis1"				column="KBIS1"/>
		<result property="bdi01"				column="BDI01"/>
		<result property="stitp"				column="STITP"/>
		<result property="stisp"				column="STISP"/>
		<result property="mbri1"				column="MBRI1"/>
		<result property="kadhd"				column="KADHD"/>
		<result property="kpsi1"				column="KPSI1"/>
		<result property="srs01"				column="SRS01"/>
		<result property="srs02"				column="SRS02"/>
		<result property="ygts1"				column="YGTS1"/>
		<result property="ygts2"				column="YGTS2"/>
		<result property="cybo2"				column="CYBO2"/>
		<result property="ybocs"				column="YBOCS"/>
		<result property="yboca"				column="YBOCA"/>
		<result property="cybo3"				column="CYBO3"/>
	</resultMap>
	
	<select id="selectDocNmByDocId" parameterType="map" resultType="String">
		SELECT 
			DOC_NM
		FROM
			T_DOC_MST
		WHERE
			DOC_ID = #{docId}
			AND DIS_CLASS_DTL = #{disClassDtl}
	</select>
	
	<select id="selectPerformCntList" parameterType="map" resultMap="surveyDtlList">
		SELECT 
			PERFORM_CNT
			, PERFORM_NM
		FROM
			T_PERFORM_TERM
		WHERE 1=1
			<if test="performNm !=null and performNm!= '' ">
		 		AND INSTR(PERFORM_NM, #{performNm}) > 0 
		 	</if>
		ORDER BY
			PERFORM_NM * 1
	</select>
	
	<select id="selectSurveyDtlList" parameterType="map" resultMap="surveyDtlList">
		SELECT B.* FROM (
			SELECT @ROWNUM := @ROWNUM+1 ROWNUM, A.* FROM (
				SELECT 
					DA.TARGET_ID
					,TM.TARGET_DIS_ID
					, CASE 
						WHEN TM.SEX = 'F' THEN '여'
						WHEN TM.SEX = 'M' THEN '남'
					END SEX
					, PM.STATUS
					, CD.CLASS_CD_DTL_NM PROTOCOL
					, DA.PERFORM_CNT
					, PT.PERFORM_NM
					, DA.DOC_ID
					, DA.RND_ID
					, FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) AGE
					, DA.CHOICE_ANSWER
					, DA.SUBJECT_ANSWER
					, DA.SCORE
				    , DA.REMARKS
				   	<if test="docId =='ARS01'">
						, CONCAT(SUBSTR(PM.ARS_DATE,1,4) ,'-',SUBSTR(PM.ARS_DATE,5,2),'-',SUBSTR(PM.ARS_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='SRS01'">
						, CONCAT(SUBSTR(PM.SRS_CLINICAL_DATE,1,4) ,'-',SUBSTR(PM.SRS_CLINICAL_DATE,5,2),'-',SUBSTR(PM.SRS_CLINICAL_DATE,7,2)) EXEC_DATE
					</if>			
					<if test="docId =='SRS02'">
						, CONCAT(SUBSTR(PM.SRS_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.SRS_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.SRS_4INTERVAL_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='KCBCL'">
						, CONCAT(SUBSTR(PM.K_CBCL_DATE,1,4) ,'-',SUBSTR(PM.K_CBCL_DATE,5,2),'-',SUBSTR(PM.K_CBCL_DATE,7,2)) EXEC_DATE	
					</if>
					<if test="docId =='CBCL1'">
						, CONCAT(SUBSTR(PM.CBCL_DATE,1,4) ,'-',SUBSTR(PM.CBCL_DATE,5,2),'-',SUBSTR(PM.CBCL_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='DBDS1'">
						, CONCAT(SUBSTR(PM.DBDS_DATE,1,4) ,'-',SUBSTR(PM.DBDS_DATE,5,2),'-',SUBSTR(PM.DBDS_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='CMRSP'">
						, CONCAT(SUBSTR(PM.CMRS_P_DATE,1,4) ,'-',SUBSTR(PM.CMRS_P_DATE,5,2),'-',SUBSTR(PM.CMRS_P_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='TRAUM'">
						, CONCAT(SUBSTR(PM.TRAUMA_DATE,1,4) ,'-',SUBSTR(PM.TRAUMA_DATE,5,2),'-',SUBSTR(PM.TRAUMA_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='CDI01'">
						, CONCAT(SUBSTR(PM.CDI_DATE,1,4) ,'-',SUBSTR(PM.CDI_DATE,5,2),'-',SUBSTR(PM.CDI_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='ITA01'">
						, CONCAT(SUBSTR(PM.IAT_DATE,1,4) ,'-',SUBSTR(PM.IAT_DATE,5,2),'-',SUBSTR(PM.IAT_DATE,7,2)) EXEC_DATE
					</if>			
					<if test="docId =='RCMAS'">
						, CONCAT(SUBSTR(PM.RCMAS_DATE,1,4) ,'-',SUBSTR(PM.RCMAS_DATE,5,2),'-',SUBSTR(PM.RCMAS_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='KSCAL'">
						, CONCAT(SUBSTR(PM.K_SCALE_DATE,1,4) ,'-',SUBSTR(PM.K_SCALE_DATE,5,2),'-',SUBSTR(PM.K_SCALE_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='STITC'">
						, CONCAT(SUBSTR(PM.STAIT_C_DATE,1,4) ,'-',SUBSTR(PM.STAIT_C_DATE,5,2),'-',SUBSTR(PM.STAIT_C_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='STISC'">
						, CONCAT(SUBSTR(PM.STAIS_C_DATE,1,4) ,'-',SUBSTR(PM.STAIS_C_DATE,5,2),'-',SUBSTR(PM.STAIS_C_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='STITY'">
						, CONCAT(SUBSTR(PM.STAIT_Y_DATE,1,4) ,'-',SUBSTR(PM.STAIT_Y_DATE,5,2),'-',SUBSTR(PM.STAIT_Y_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='STISY'">
						, CONCAT(SUBSTR(PM.STAIS_Y_DATE,1,4) ,'-',SUBSTR(PM.STAIS_Y_DATE,5,2),'-',SUBSTR(PM.STAIS_Y_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='LOICV'">
						, CONCAT(SUBSTR(PM.LOI_CV_DATE,1,4) ,'-',SUBSTR(PM.LOI_CV_DATE,5,2),'-',SUBSTR(PM.LOI_CV_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='KBIS1'">
						, CONCAT(SUBSTR(PM.KBIS_11R_DATE,1,4) ,'-',SUBSTR(PM.KBIS_11R_DATE,5,2),'-',SUBSTR(PM.KBIS_11R_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='BDI01'">
						, CONCAT(SUBSTR(PM.BDI_DATE,1,4) ,'-',SUBSTR(PM.BDI_DATE,5,2),'-',SUBSTR(PM.BDI_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='STITP'">
						, CONCAT(SUBSTR(PM.STAIT_P_DATE,1,4) ,'-',SUBSTR(PM.STAIT_P_DATE,5,2),'-',SUBSTR(PM.STAIT_P_DATE,7,2)) EXEC_DATE 
					</if>
					<if test="docId =='STISP'">
						, CONCAT(SUBSTR(PM.STAIS_P_DATE,1,4) ,'-',SUBSTR(PM.STAIS_P_DATE,5,2),'-',SUBSTR(PM.STAIS_P_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='IAT01'">
						, CONCAT(SUBSTR(PM.IAT_DATE,1,4) ,'-',SUBSTR(PM.IAT_DATE,5,2),'-',SUBSTR(PM.IAT_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='MBRI1'">
						, CONCAT(SUBSTR(PM.MBRI_DATE,1,4) ,'-',SUBSTR(PM.MBRI_DATE,5,2),'-',SUBSTR(PM.MBRI_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='KADHD'">
						, CONCAT(SUBSTR(PM.KAADHDS_ADULT_DATE,1,4) ,'-',SUBSTR(PM.KAADHDS_ADULT_DATE,5,2),'-',SUBSTR(PM.KAADHDS_ADULT_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='KPSI1'">
						, CONCAT(SUBSTR(PM.K_PSI_DATE,1,4) ,'-',SUBSTR(PM.K_PSI_DATE,5,2),'-',SUBSTR(PM.K_PSI_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='CYBO2'">
						, CONCAT(SUBSTR(PM.CYBOCS_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.CYBOCS_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.CYBOCS_4INTERVAL_DATE,7,2)) EXEC_DATE
					</if>
					<if test="docId =='YBOCS'">
						, CONCAT(SUBSTR(PM.YBOCS_DATE,1,4) ,'-',SUBSTR(PM.YBOCS_DATE,5,2),'-',SUBSTR(PM.YBOCS_DATE,7,2)) EXEC_DATE		
					</if>
					<if test="docId =='YBOCA'">
						, CONCAT(SUBSTR(PM.YBOCA_DATE,1,4) ,'-',SUBSTR(PM.YBOCA_DATE,5,2),'-',SUBSTR(PM.YBOCA_DATE,7,2)) EXEC_DATE		
					</if>
					<if test="docId =='YGTS1'">
						, CONCAT(SUBSTR(PM.YGTSS_CLINICAL_DATE,1,4) ,'-',SUBSTR(PM.YGTSS_CLINICAL_DATE,5,2),'-',SUBSTR(PM.YGTSS_CLINICAL_DATE,7,2)) EXEC_DATE		
					</if>
					<if test="docId =='YGTS2'">
						, CONCAT(SUBSTR(PM.YGTSS_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.YGTSS_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.YGTSS_4INTERVAL_DATE,7,2)) EXEC_DATE		
					</if>
					<if test="docId =='CYBO3'">
						, CONCAT(SUBSTR(PM.CYBOCP_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.CYBOCP_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.CYBOCP_4INTERVAL_DATE,7,2)) EXEC_DATE		
					</if>
					<if test="docId =='PRDV1'">
						, CONCAT(SUBSTR(DA.REMARKS,1,4) ,'-',SUBSTR(DA.REMARKS,5,2),'-',SUBSTR(DA.REMARKS,7,2)) EXEC_DATE		
					</if>
				FROM 
					(SELECT 
							DOC_ID
							, TARGET_ID
							, PERFORM_CNT
							, RND_ID
							, GROUP_CONCAT(CHOICE_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR '|') CHOICE_ANSWER
                            , GROUP_CONCAT(SUBJECT_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SUBJECT_ANSWER
				            , GROUP_CONCAT(SCORE ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SCORE
				            , GROUP_CONCAT(REMARKS ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') REMARKS
                            FROM (
								SELECT 
									DOC_ID
									, TARGET_ID
									, PERFORM_CNT
									, RND_ID
									, INQ_NO
									, CASE WHEN CHOICE_ANSWER IS NULL OR CHOICE_ANSWER = '' THEN 'x' WHEN CHOICE_ANSWER = '#' THEN '-' ELSE CHOICE_ANSWER END CHOICE_ANSWER
									, CASE WHEN SUBJECT_ANSWER IS NULL OR SUBJECT_ANSWER = ' ' THEN 'x' WHEN SUBJECT_ANSWER = '#' THEN '-' ELSE SUBJECT_ANSWER END SUBJECT_ANSWER
									, CASE WHEN SCORE IS NULL OR SCORE = '' THEN 'x' WHEN SCORE = '#' THEN '-' ELSE SCORE END SCORE
									, CASE WHEN REMARKS IS NULL OR REMARKS = '' THEN 'x' WHEN REMARKS = '#' THEN '-' ELSE REMARKS END REMARKS
							FROM 
								T_DOC_ANSWER
						WHERE 1=1
							<if test="docId !=null and docId != '' ">
						 		AND DOC_ID = #{docId}
						 	</if>
						 	<if test="schKeyWord !='schTargetId' ">
							 	<if test="targetId !=null and targetId != '' ">
							 		AND TARGET_ID = #{targetId}
							 	</if>
							 	<if test="performCnt !=null and performCnt != '' ">
							 		AND PERFORM_CNT = #{performCnt}
							 	</if>
							 </if>
							 <if test="docId != 'CYBO2' and docId != 'CYBO3' and docId != 'SRS02' and docId != 'YGTS2'">
							 	AND PERFORM_CNT NOT IN (2,3)
							 </if>
							 ) DA1
						GROUP BY
							DOC_ID, TARGET_ID, PERFORM_CNT, RND_ID) DA
				JOIN (SELECT @ROWNUM:=0) AS R
				JOIN
					T_TARGET_MST TM
				ON
					DA.TARGET_ID = TM.TARGET_ID
					AND TM.USE_YN = 'Y'
				LEFT JOIN
					T_TARGET_DIS_MST TDM
				ON
					TM.TARGET_ID = TDM.TARGET_ORG_ID
					AND TM.TARGET_DIS_ID = TDM.TARGET_ID
				LEFT JOIN
					T_CODE_DTL CD
				ON
					TM.PROTOCOL = CD.CLASS_CD_DTL
				JOIN
					T_PERFORM_TERM PT
				ON
					DA.PERFORM_CNT = PT.PERFORM_CNT
				LEFT JOIN
					T_PERFORM_MST PM
				ON
					DA.TARGET_ID = PM.TARGET_ID
				    AND DA.PERFORM_CNT = PM.PERFORM_CNT
				    AND DA.RND_ID = PM.RND_ID
--				    AND PM.DIS_CLASS_DTL = TM.DIS_CLASS_DTL
				WHERE 1=1
					<if test="disClassDtl !=null and disClassDtl != '' ">
						AND TM.DIS_CLASS_DTL = #{disClassDtl}
					</if>
					<if test="schKeyWord !='schTargetId' ">
						<if test="targetId !=null and targetId != '' ">
					 		AND UPPER(DA.TARGET_ID) = UPPER(#{targetId})
					 	</if>
					 	<if test="targetDisId !=null and targetDisId != '' ">
					 		AND UPPER(TM.TARGET_DIS_ID) = UPPER(#{targetDisId})
					 	</if>
					 	<if test="docId !=null and docId != '' ">
			                AND DA.DOC_ID = #{docId}
			            </if>
					 	<if test="startAge !=null and startAge != '' ">
							AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &gt;= #{startAge}
						</if>
						<if test="endAge !=null and endAge != '' ">
							AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &lt;= #{endAge}
						</if>
						<if test="sex !=null and sex != '' ">
					 		AND TM.SEX = #{sex}
					 	</if>
						<if test="protocol !=null and protocol != '' ">
							AND  REPLACE(CD.CLASS_CD_DTL_NM," ","")   IN (${protocol})
						</if>
						<if test="performCnt !=null and performCnt != '' ">
					 		AND DA.PERFORM_CNT = #{performCnt}
					 	</if>
						<if test="performNm !=null and performNm != '' ">
					 		AND PT.PERFORM_NM = #{performNm}
					 	</if>
					 </if>
				ORDER BY
					DA.TARGET_ID, DA.PERFORM_CNT
					) A
				)B
				WHERE 1=1
					AND B.STATUS != '0004' 				
			 	<if test="schKeyWord == 'schTargetId' ">
					AND TARGET_ID = #{targetId}
					AND PERFORM_CNT = ${performCnt}
					AND DOC_ID = #{docId}
				</if>
		LIMIT #{start}, #{limit}
	</select>
	
	<select id="selectSurveyDtlExcelList" parameterType="map" resultMap="surveyDtlList">
		SELECT 
			DA.TARGET_ID
			, CASE 
				WHEN TM.SEX = 'F' THEN '여'
				WHEN TM.SEX = 'M' THEN '남'
			END SEX
			, CD.CLASS_CD_DTL_NM PROTOCOL
			, DA.PERFORM_CNT
			, PT.PERFORM_NM
			, DA.RND_ID
			, FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) AGE
			, DA.CHOICE_ANSWER
			, DA.SUBJECT_ANSWER
			, DA.SCORE
		    , DA.REMARKS
		    <if test="docId =='ARS01'">
				, CONCAT(SUBSTR(PM.ARS_DATE,1,4) ,'-',SUBSTR(PM.ARS_DATE,5,2),'-',SUBSTR(PM.ARS_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='SRS01'">
				, CONCAT(SUBSTR(PM.SRS_CLINICAL_DATE,1,4) ,'-',SUBSTR(PM.SRS_CLINICAL_DATE,5,2),'-',SUBSTR(PM.SRS_CLINICAL_DATE,7,2)) EXEC_DATE
			</if>			
			<if test="docId =='SRS02'">
				, CONCAT(SUBSTR(PM.SRS_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.SRS_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.SRS_4INTERVAL_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='KCBCL'">
				, CONCAT(SUBSTR(PM.K_CBCL_DATE,1,4) ,'-',SUBSTR(PM.K_CBCL_DATE,5,2),'-',SUBSTR(PM.K_CBCL_DATE,7,2)) EXEC_DATE	
			</if>
			<if test="docId =='CBCL1'">
				, CONCAT(SUBSTR(PM.CBCL_DATE,1,4) ,'-',SUBSTR(PM.CBCL_DATE,5,2),'-',SUBSTR(PM.CBCL_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='DBDS1'">
				, CONCAT(SUBSTR(PM.DBDS_DATE,1,4) ,'-',SUBSTR(PM.DBDS_DATE,5,2),'-',SUBSTR(PM.DBDS_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='CMRSP'">
				, CONCAT(SUBSTR(PM.CMRS_P_DATE,1,4) ,'-',SUBSTR(PM.CMRS_P_DATE,5,2),'-',SUBSTR(PM.CMRS_P_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='TRAUM'">
				, CONCAT(SUBSTR(PM.TRAUMA_DATE,1,4) ,'-',SUBSTR(PM.TRAUMA_DATE,5,2),'-',SUBSTR(PM.TRAUMA_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='CDI01'">
				, CONCAT(SUBSTR(PM.CDI_DATE,1,4) ,'-',SUBSTR(PM.CDI_DATE,5,2),'-',SUBSTR(PM.CDI_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='ITA01'">
				, CONCAT(SUBSTR(PM.IAT_DATE,1,4) ,'-',SUBSTR(PM.IAT_DATE,5,2),'-',SUBSTR(PM.IAT_DATE,7,2)) EXEC_DATE
			</if>			
			<if test="docId =='RCMAS'">
				, CONCAT(SUBSTR(PM.RCMAS_DATE,1,4) ,'-',SUBSTR(PM.RCMAS_DATE,5,2),'-',SUBSTR(PM.RCMAS_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='KSCAL'">
				, CONCAT(SUBSTR(PM.K_SCALE_DATE,1,4) ,'-',SUBSTR(PM.K_SCALE_DATE,5,2),'-',SUBSTR(PM.K_SCALE_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='STITC'">
				, CONCAT(SUBSTR(PM.STAIT_C_DATE,1,4) ,'-',SUBSTR(PM.STAIT_C_DATE,5,2),'-',SUBSTR(PM.STAIT_C_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='STISC'">
				, CONCAT(SUBSTR(PM.STAIS_C_DATE,1,4) ,'-',SUBSTR(PM.STAIS_C_DATE,5,2),'-',SUBSTR(PM.STAIS_C_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='STITY'">
				, CONCAT(SUBSTR(PM.STAIT_Y_DATE,1,4) ,'-',SUBSTR(PM.STAIT_Y_DATE,5,2),'-',SUBSTR(PM.STAIT_Y_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='STISY'">
				, CONCAT(SUBSTR(PM.STAIS_Y_DATE,1,4) ,'-',SUBSTR(PM.STAIS_Y_DATE,5,2),'-',SUBSTR(PM.STAIS_Y_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='LOICV'">
				, CONCAT(SUBSTR(PM.LOI_CV_DATE,1,4) ,'-',SUBSTR(PM.LOI_CV_DATE,5,2),'-',SUBSTR(PM.LOI_CV_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='KBIS1'">
				, CONCAT(SUBSTR(PM.KBIS_11R_DATE,1,4) ,'-',SUBSTR(PM.KBIS_11R_DATE,5,2),'-',SUBSTR(PM.KBIS_11R_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='BDI01'">
				, CONCAT(SUBSTR(PM.BDI_DATE,1,4) ,'-',SUBSTR(PM.BDI_DATE,5,2),'-',SUBSTR(PM.BDI_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='STITP'">
				, CONCAT(SUBSTR(PM.STAIT_P_DATE,1,4) ,'-',SUBSTR(PM.STAIT_P_DATE,5,2),'-',SUBSTR(PM.STAIT_P_DATE,7,2)) EXEC_DATE 
			</if>
			<if test="docId =='STISP'">
				, CONCAT(SUBSTR(PM.STAIS_P_DATE,1,4) ,'-',SUBSTR(PM.STAIS_P_DATE,5,2),'-',SUBSTR(PM.STAIS_P_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='IAT01'">
				, CONCAT(SUBSTR(PM.IAT_DATE,1,4) ,'-',SUBSTR(PM.IAT_DATE,5,2),'-',SUBSTR(PM.IAT_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='MBRI1'">
				, CONCAT(SUBSTR(PM.MBRI_DATE,1,4) ,'-',SUBSTR(PM.MBRI_DATE,5,2),'-',SUBSTR(PM.MBRI_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='KADHD'">
				, CONCAT(SUBSTR(PM.KAADHDS_ADULT_DATE,1,4) ,'-',SUBSTR(PM.KAADHDS_ADULT_DATE,5,2),'-',SUBSTR(PM.KAADHDS_ADULT_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='KPSI1'">
				, CONCAT(SUBSTR(PM.K_PSI_DATE,1,4) ,'-',SUBSTR(PM.K_PSI_DATE,5,2),'-',SUBSTR(PM.K_PSI_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='CYBO2'">
				, CONCAT(SUBSTR(PM.CYBOCS_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.CYBOCS_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.CYBOCS_4INTERVAL_DATE,7,2)) EXEC_DATE
			</if>
			<if test="docId =='YBOCS'">
				, CONCAT(SUBSTR(PM.YBOCS_DATE,1,4) ,'-',SUBSTR(PM.YBOCS_DATE,5,2),'-',SUBSTR(PM.YBOCS_DATE,7,2)) EXEC_DATE		
			</if>
			<if test="docId =='YBOCA'">
				, CONCAT(SUBSTR(PM.YBOCA_DATE,1,4) ,'-',SUBSTR(PM.YBOCA_DATE,5,2),'-',SUBSTR(PM.YBOCA_DATE,7,2)) EXEC_DATE		
			</if>
			<if test="docId =='YGTS1'">
				, CONCAT(SUBSTR(PM.YGTSS_CLINICAL_DATE,1,4) ,'-',SUBSTR(PM.YGTSS_CLINICAL_DATE,5,2),'-',SUBSTR(PM.YGTSS_CLINICAL_DATE,7,2)) EXEC_DATE		
			</if>
			<if test="docId =='YGTS2'">
				, CONCAT(SUBSTR(PM.YGTSS_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.YGTSS_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.YGTSS_4INTERVAL_DATE,7,2)) EXEC_DATE		
			</if>
			<if test="docId =='YBOCA'">
				, CONCAT(SUBSTR(PM.YBOCA_DATE,1,4) ,'-',SUBSTR(PM.YBOCA_DATE,5,2),'-',SUBSTR(PM.YBOCA_DATE,7,2)) EXEC_DATE		
			</if>
			<if test="docId =='CYBO3'">
				, CONCAT(SUBSTR(PM.CYBOCP_4INTERVAL_DATE,1,4) ,'-',SUBSTR(PM.CYBOCP_4INTERVAL_DATE,5,2),'-',SUBSTR(PM.CYBOCP_4INTERVAL_DATE,7,2)) EXEC_DATE		
			</if>
			<if test="docId =='PRDV1'">
				, CONCAT(SUBSTR(DA.REMARKS,1,4) ,'-',SUBSTR(DA.REMARKS,5,2),'-',SUBSTR(DA.REMARKS,7,2)) EXEC_DATE		
			</if>
		FROM 
			(SELECT 
							DOC_ID
							, TARGET_ID
							, PERFORM_CNT
							, RND_ID
							, GROUP_CONCAT(CHOICE_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR '|') CHOICE_ANSWER
                            , GROUP_CONCAT(SUBJECT_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SUBJECT_ANSWER
				            , GROUP_CONCAT(SCORE ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SCORE
				            , GROUP_CONCAT(REMARKS ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') REMARKS
                            FROM (
								SELECT 
									DOC_ID
									, TARGET_ID
									, PERFORM_CNT
									, RND_ID
									, INQ_NO
									, CASE WHEN CHOICE_ANSWER IS NULL OR CHOICE_ANSWER = '' THEN 'x' WHEN CHOICE_ANSWER = '#' THEN '-' ELSE CHOICE_ANSWER END CHOICE_ANSWER
									, CASE WHEN SUBJECT_ANSWER IS NULL OR SUBJECT_ANSWER = ' ' THEN 'x' WHEN SUBJECT_ANSWER = '#' THEN '-' ELSE SUBJECT_ANSWER END SUBJECT_ANSWER
									, CASE WHEN SCORE IS NULL OR SCORE = '' THEN 'x' WHEN SCORE = '#' THEN '-' ELSE SCORE END SCORE
									, CASE WHEN REMARKS IS NULL OR REMARKS = '' THEN 'x' WHEN REMARKS = '#' THEN '-' ELSE REMARKS END REMARKS
							FROM 
								T_DOC_ANSWER
				WHERE 1=1
					<if test="docId !=null and docId != '' ">
				 		AND DOC_ID = #{docId}
				 	</if>
				 	<if test="docId != 'CYBO2' and docId != 'CYBO3' and docId != 'SRS02' and docId != 'YGTS2'">
						AND PERFORM_CNT NOT IN (2,3)
					</if>
					) DA1
				GROUP BY
					DOC_ID, TARGET_ID, PERFORM_CNT, RND_ID) DA
		LEFT JOIN
			T_TARGET_MST TM
		ON
			DA.TARGET_ID = TM.TARGET_ID
			AND TM.USE_YN = 'Y'
		LEFT JOIN
			T_CODE_DTL CD
		ON
			TM.PROTOCOL = CD.CLASS_CD_DTL
		JOIN
			T_PERFORM_TERM PT
		ON
			DA.PERFORM_CNT = PT.PERFORM_CNT
		LEFT JOIN
			T_PERFORM_MST PM
		ON
			DA.TARGET_ID = PM.TARGET_ID
		    AND DA.PERFORM_CNT = PM.PERFORM_CNT
		    AND DA.RND_ID = PM.RND_ID
		WHERE 1=1
			<if test="targetId !=null and targetId != '' ">
		 		AND UPPER(DA.TARGET_ID) = UPPER(#{targetId})
		 	</if>
		 	<if test="startAge !=null and startAge != '' ">
				AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &gt;= #{startAge}
			</if>
			<if test="endAge !=null and endAge != '' ">
				AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &lt;= #{endAge}
			</if>
			<if test="sex !=null and sex != '' ">
		 		AND TM.SEX = #{sex}
		 	</if>
			<if test="ptYn !=null and ptYn != '' ">
				<if test='ptYn =="Y"'>
					AND TM.PROTOCOL NOT IN ('PTC03')
				</if>
				<if test='ptYn =="N"'>
					AND TM.PROTOCOL = 'PTC03'
				</if>
		 	</if>
			<if test="performCnt !=null and performCnt != '' ">
		 		AND DA.PERFORM_CNT = #{performCnt}
		 	</if>
		ORDER BY
			DA.TARGET_ID, DA.PERFORM_CNT
	</select>
	
	<select id="selectSurveyDtlListTotal" parameterType="map" resultType="int">
		SELECT COUNT(TARGET_ID) FROM (
			SELECT 
				DA.TARGET_ID
				, FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) AGE
			FROM 
					(SELECT 
							DOC_ID
							, TARGET_ID
							, PERFORM_CNT
							, RND_ID
						FROM 
							T_DOC_ANSWER
						WHERE 1=1
							<if test="docId !=null and docId != '' ">
						 		AND DOC_ID = #{docId}
						 	</if>
						 	<if test="docId != 'CYBO2' and docId != 'CYBO3' and docId != 'SRS02' and docId != 'YGTS2'">
							 	AND PERFORM_CNT NOT IN (2,3)
							</if>
						GROUP BY
							DOC_ID, TARGET_ID, PERFORM_CNT, RND_ID) DA
				JOIN
					T_TARGET_MST TM
				ON
					DA.TARGET_ID = TM.TARGET_ID
					AND TM.USE_YN = 'Y'
				LEFT JOIN
					T_TARGET_DIS_MST TDM
				ON
					TM.TARGET_ID = TDM.TARGET_ORG_ID
					AND TM.TARGET_DIS_ID = TDM.TARGET_ID
				LEFT JOIN
					T_CODE_DTL CD
				ON
					TM.PROTOCOL = CD.CLASS_CD_DTL
				JOIN
					T_PERFORM_TERM PT
				ON
					DA.PERFORM_CNT = PT.PERFORM_CNT
				LEFT JOIN
					T_PERFORM_MST PM
				ON
					DA.TARGET_ID = PM.TARGET_ID
				    AND DA.PERFORM_CNT = PM.PERFORM_CNT
				    AND DA.RND_ID = PM.RND_ID
--				    AND PM.DIS_CLASS_DTL = 'DS001'
				WHERE 1=1
                AND PM.STATUS != '0004'
                	<if test="disClassDtl !=null and disClassDtl != '' ">
						AND TM.DIS_CLASS_DTL = #{disClassDtl}
					</if>
					<if test="schKeyWord !='schTargetId' ">
						<if test="targetId !=null and targetId != '' ">
					 		AND UPPER(DA.TARGET_ID) = UPPER(#{targetId})
					 	</if>
					 	<if test="startAge !=null and startAge != '' ">
							AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &gt;= #{startAge}
						</if>
						<if test="endAge !=null and endAge != '' ">
							AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &lt;= #{endAge}
						</if>
						<if test="sex !=null and sex != '' ">
					 		AND TM.SEX = #{sex}
					 	</if>
						<if test="protocol !=null and protocol != '' ">
							AND  REPLACE(CD.CLASS_CD_DTL_NM," ","")   IN (${protocol})
						</if>
						<if test="performCnt !=null and performCnt != '' ">
					 		AND DA.PERFORM_CNT = #{performCnt}
					 	</if>
						<if test="performNm !=null and performNm != '' ">
					 		AND PT.PERFORM_NM = #{performNm}
					 	</if>
					 </if>
					) A
				WHERE 1=1
			 	<if test="schKeyWord == 'schTargetId' ">
					AND TARGET_ID = #{targetId}
					AND PERFORM_CNT = ${performCnt}
					AND DOC_ID = #{docId}
				</if>
	</select>

	<select id="selectSurveyMenuList" parameterType="map" resultMap="surveyMenuList">
		SELECT
			DOC_ID,
			DOC_NM,
			DIS_CLASS_DTL,
			DOC_CLASS_DTL,
			DOC_HEADER
		FROM BDSP.T_DOC_MST
		WHERE 1=1
		<if test="disClassDtl == 'DS001'">
			AND DOC_ID NOT IN('CYBO1')
			AND DOC_ID NOT IN('CBCL1')
		</if>
			<if test="docClassDtl !=null and docClassDtl != '' ">
		 		AND DOC_CLASS_DTL = #{docClassDtl}
		 	</if>
		 	AND DIS_CLASS_DTL = #{disClassDtl}
		ORDER BY SORT_NO	
	</select>
	
	<select id="selectRndId" parameterType="map" resultType="String">
		SELECT RND_ID
		FROM T_RND_MST
		ORDER BY RND_ID
		LIMIT 0,1
	</select>
	
	<select id="selectPerformCntByNm" parameterType="map" resultType="String">
		SELECT PERFORM_CNT
		FROM T_PERFORM_TERM
		WHERE PERFORM_NM = #{performCnt}
	</select>
	
	<select id="selectPerformCntByIv4" parameterType="map" resultMap="surveyDtlList">
		SELECT PERFORM_CNT 
		FROM T_PERFORM_TERM 
		WHERE INSTR(PERFORM_NM, 'W') > 0
	</select>

	<update id="updateSurveyCv" parameterType="map">
		UPDATE 
			T_PERFORM_MST 
		SET
			CV_CGI_S= #{cvCgiS}
			, CV_CGI_I= #{cvCgiI}
			, CV_C_GAS= #{cvCGas}
			, CLINICAL_VALUATION = #{clinicalValuation}
			, UPDATE_DATE = now()
			, UPDATE_BY = #{updateBy}
		WHERE
			TARGET_ID = #{targetId}
			AND DIS_CLASS_DTL = 'DS001'
			AND PERFORM_CNT = #{performCnt}
			AND RND_ID = #{rndId}
	</update>

	<update id="updateSurveyIv4" parameterType="map">
		UPDATE
			T_PERFORM_MST 
		SET
			IV4_CGI_S= #{iv4CgiS}
			, IV4_CGI_I= #{iv4CgiI}
			, IV4_C_GAS= #{iv4CGas}
			, PILL_CNT_USED= #{pillCntUsed}
			, PILL_CNT_KIND= #{pillCntKind}
			, PILL_CNT_TOTAL= #{pillCntTotal}
			, PILL_CNT_EATEN= #{pillCntEaten}
			, 4INTERVAL_INTERVIEW = #{fourIntervalInterview}
			, UPDATE_DATE = now()
			, UPDATE_BY = #{updateBy}
		WHERE
			TARGET_ID = #{targetId}
			AND DIS_CLASS_DTL = 'DS001'
			AND PERFORM_CNT = #{performCnt}
			AND RND_ID = #{rndId}
	</update>
	
	<update id="insertSurveyDocAnswer" parameterType="map">
		INSERT INTO T_DOC_ANSWER(
			DOC_ID
			, TARGET_ID
			, PERFORM_CNT
			, INQ_NO
			, RND_ID
			, CHOICE_ANSWER
			, SUBJECT_ANSWER
			, SCORE
			, REMARKS
			, CREATE_DATE
			, CREATE_BY
			, UPDATE_DATE
			, UPDATE_BY
		)VALUES(
			#{docId, jdbcType=VARCHAR}
			, #{targetId, jdbcType=VARCHAR}
			, #{performCnt, jdbcType=NUMERIC}
			, #{inqNo, jdbcType=NUMERIC}
			, #{rndId, jdbcType=VARCHAR}
			, #{choiceAnswer, jdbcType=VARCHAR}
			, #{subjectAnswer, jdbcType=VARCHAR}
			, #{score, jdbcType=VARCHAR}
			, #{remarks, jdbcType=VARCHAR}
			, now()
			, #{createBy , jdbcType=VARCHAR}
			, now()
			, #{createBy , jdbcType=VARCHAR}
		)
		ON DUPLICATE KEY UPDATE
			CHOICE_ANSWER = #{choiceAnswer, jdbcType=VARCHAR}
			, SUBJECT_ANSWER = #{subjectAnswer, jdbcType=VARCHAR}
			, SCORE = #{score, jdbcType=VARCHAR}
			, UPDATE_DATE = now()
			, UPDATE_BY = #{createBy , jdbcType=VARCHAR}
	</update>
	
	<delete id="deleteSurveyAnswer" parameterType="map">
		DELETE FROM T_DOC_ANSWER
		WHERE
			TARGET_ID = #{targetId, jdbcType=VARCHAR}
			AND PERFORM_CNT = #{performCnt, jdbcType=NUMERIC}
			<if test="docId !=null and docId != '' ">
			<if test='docId !="Total"'>
			AND DOC_ID = #{docId, jdbcType=VARCHAR}
			</if>
			</if>
			<if test="inqNo !=null and inqNo != '' ">
		 		AND INQ_NO = #{inqNo}
		 	</if>
	</delete>
	
	<select id="selectSurveyTotalList" parameterType="map" resultMap="surveyTotalList">
		SELECT
			A.*
		FROM(
		SELECT
			TM.TARGET_ID
			,TM.TARGET_DIS_ID
			,CASE 
				WHEN TM.SEX = 'F' THEN '여'
				WHEN TM.SEX = 'M' THEN '남'
			END SEX
			,IFNULL(CD.CLASS_CD_DTL_NM, '') PROTOCOL
			, TM.PROTOCOL TP
			,PM.PERFORM_CNT
			,IFNULL(PT.PERFORM_NM,'') PERFORM_NM
			,FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) AGE
			, CONCAT(SUBSTR(PM.VISIT_DATE,1,4) ,'-',SUBSTR(PM.VISIT_DATE,5,2),'-',SUBSTR(PM.VISIT_DATE,7,2)) VISIT_DATE
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.ARS) OR PM.ARS = '' OR PM.ARS = 'Z' THEN 'x' WHEN PM.ARS='#' THEN '-' ELSE 'o' END ARS01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.K_CBCL) OR PM.K_CBCL = '' OR PM.K_CBCL = 'Z' THEN 'x' WHEN PM.K_CBCL='#' THEN '-' ELSE 'o' END KCBCL
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CBCL) OR PM.CBCL = '' OR PM.CBCL = 'Z' THEN 'x' WHEN PM.CBCL='#' THEN '-' ELSE 'o' END CBCL1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.DBDS) OR PM.DBDS = '' OR PM.DBDS = 'Z' THEN 'x' WHEN PM.DBDS='#' THEN '-' ELSE 'o' END DBDS1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CMRS_P) OR PM.CMRS_P = '' OR PM.CMRS_P ='Z' THEN 'x' WHEN PM.CMRS_P='#' THEN '-' ELSE 'o' END CMRSP
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.TRAUMA) OR PM.TRAUMA = '' OR PM.TRAUMA = 'Z' THEN 'x' WHEN PM.TRAUMA='#' THEN '-' ELSE 'o' END TRAUM
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CDI_C) OR PM.CDI_C = '' OR PM.CDI_C THEN 'x' WHEN PM.CDI_C='#' THEN '-' ELSE 'o' END CDI01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.IAT) OR PM.IAT  = '' OR PM.IAT = 'Z' THEN 'x' WHEN PM.IAT='#' THEN '-' ELSE 'o' END IAT01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.K_SCALE) OR PM.K_SCALE = '' OR PM.K_SCALE = 'Z' THEN 'x' WHEN PM.K_SCALE='#' THEN '-' ELSE 'o' END KSCAL
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.RCMAS) OR PM.RCMAS  = '' OR PM.RCMAS = 'Z' THEN 'x' WHEN PM.RCMAS='#' THEN '-' ELSE 'o' END RCMAS
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIT_C) OR PM.STAIT_C = '' OR PM.STAIT_C = 'Z' THEN 'x' WHEN PM.STAIT_C='#' THEN '-' ELSE 'o' END STITC
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIS_C) OR PM.STAIS_C = '' OR PM.STAIS_C = 'Z' THEN 'x' WHEN PM.STAIS_C='#' THEN '-' ELSE 'o' END STISC
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIT_Y) OR PM.STAIT_Y = '' OR PM.STAIT_Y = 'Z' THEN 'x' WHEN PM.STAIT_Y='#' THEN '-' ELSE 'o' END STITY
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIS_Y) OR PM.STAIS_Y = '' OR PM.STAIS_Y = 'Z' THEN 'x' WHEN PM.STAIS_Y='#' THEN '-' ELSE 'o' END STISY
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.LOI_CV) OR PM.LOI_CV = '' OR PM.LOI_CV = 'Z' THEN 'x' WHEN PM.LOI_CV='#' THEN '-' ELSE 'o' END LOICV
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.KBIS_11R) OR PM.KBIS_11R = '' OR PM.KBIS_11R = 'Z' THEN 'x' WHEN PM.KBIS_11R='#' THEN '-' ELSE 'o' END KBIS1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.BDI) OR PM.BDI = '' OR PM.BDI = 'Z' THEN 'x' WHEN PM.BDI='#' THEN '-' ELSE 'o' END BDI01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIT_P) OR PM.STAIT_P = '' OR PM.STAIT_P = 'Z' THEN 'x' WHEN PM.STAIT_P='#' THEN '-' ELSE 'o' END STITP
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIS_P) OR PM.STAIS_P = '' OR PM.STAIS_P = 'Z' THEN 'x' WHEN PM.STAIS_P='#' THEN '-' ELSE 'o' END STISP
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.MBRI) OR PM.MBRI = '' OR PM.MBRI = 'Z' THEN 'x' WHEN PM.MBRI='#' THEN '-' ELSE 'o' END MBRI1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.KAADHDS_ADULT) OR PM.KAADHDS_ADULT = '' OR PM.KAADHDS_ADULT = 'Z' THEN 'x' WHEN PM.KAADHDS_ADULT='#' THEN '-' ELSE 'o' END KADHD
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.K_PSI) OR PM.K_PSI = '' OR PM.K_PSI = 'Z' THEN 'x' WHEN PM.K_PSI='#' THEN '-' ELSE 'o' END KPSI1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.SRS_CLINICAL) OR PM.SRS_CLINICAL = '' OR PM.SRS_CLINICAL = 'Z' THEN 'x' WHEN PM.SRS_CLINICAL='#' THEN '-' ELSE 'o' END SRS01
            , CASE WHEN ISNULL(PM.SRS_4INTERVAL) OR PM.SRS_4INTERVAL = '' OR PM.SRS_4INTERVAL = 'Z' THEN 'x' WHEN PM.SRS_4INTERVAL='#' THEN '-' ELSE 'o' END SRS02
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.YGTSS_CLINICAL) OR PM.YGTSS_CLINICAL = '' OR PM.YGTSS_CLINICAL = 'Z' THEN 'x' WHEN PM.YGTSS_CLINICAL='#' THEN '-' ELSE 'o' END YGTS1
            , CASE WHEN ISNULL(PM.YGTSS_4INTERVAL) OR PM.YGTSS_4INTERVAL = '' OR PM.YGTSS_4INTERVAL = 'Z' THEN 'x' WHEN PM.YGTSS_4INTERVAL='#' THEN '-' ELSE 'o' END YGTS2
            , CASE WHEN ISNULL(PM.CYBOCS_4INTERVAL) OR PM.CYBOCS_4INTERVAL = '' OR PM.CYBOCS_4INTERVAL = 'Z' THEN 'x' WHEN PM.CYBOCS_4INTERVAL='#' THEN '-' ELSE 'o' END CYBO2
            , CASE WHEN ISNULL(PM.CYBOCP_4INTERVAL) OR PM.CYBOCP_4INTERVAL = '' OR PM.CYBOCP_4INTERVAL = 'Z' THEN 'x' WHEN PM.CYBOCP_4INTERVAL='#' THEN '-' ELSE 'o' END CYBO3
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.YBOCA) OR PM.YBOCA = '' OR PM.YBOCA = 'Z' THEN 'x' WHEN PM.YBOCA='#' THEN '-' ELSE 'o' END YBOCA
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.YBOCS) OR PM.YBOCS = '' OR PM.YBOCS = 'Z' THEN 'x' WHEN PM.YBOCS='#' THEN '-' ELSE 'o' END YBOCS
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CV_CGI_S) OR PM.CV_CGI_S = '' THEN 'x' WHEN PM.CV_CGI_S ='#' THEN '-' ELSE PM.CV_CGI_S END CV_CGI_S
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CV_CGI_I) OR PM.CV_CGI_I = '' THEN 'x' WHEN PM.CV_CGI_I='#' THEN '-' ELSE PM.CV_CGI_I END CV_CGI_I
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CV_C_GAS) OR PM.CV_C_GAS = '' THEN 'x' WHEN PM.CV_C_GAS='#' THEN '-' ELSE PM.CV_C_GAS END CV_C_GAS
            , CASE WHEN ISNULL(PM.IV4_CGI_S) OR PM.IV4_CGI_S = '' THEN 'x' WHEN PM.IV4_CGI_S='#' THEN '-' ELSE PM.IV4_CGI_S END IV4_CGI_S
            , CASE WHEN ISNULL(PM.IV4_CGI_I) OR PM.IV4_CGI_I = '' THEN 'x' WHEN PM.IV4_CGI_I='#' THEN '-' ELSE PM.IV4_CGI_I END IV4_CGI_I
            , CASE WHEN ISNULL(PM.IV4_C_GAS) OR PM.IV4_C_GAS = '' THEN 'x' WHEN PM.IV4_C_GAS='#' THEN '-' ELSE PM.IV4_C_GAS END IV4_C_GAS
            , IFNULL(PM.PILL_CNT_KIND, 'x') PILL_CNT_KIND
			, IFNULL(PM.PILL_CNT_USED, 'x') PILL_CNT_USED
			, IFNULL(PM.PILL_CNT_TOTAL, 'x') PILL_CNT_TOTAL
			, IFNULL(PM.PILL_CNT_EATEN, 'x') PILL_CNT_EATEN
		FROM T_TARGET_MST TM
		JOIN T_PERFORM_MST PM
        	ON TM.TARGET_ID = PM.TARGET_ID
        	AND TM.RND_ID = PM.RND_ID
        	AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
        	AND PM.STATUS != '0004'
        LEFT JOIN T_TARGET_DIS_MST TDM
        	ON TM.TARGET_ID = TDM.TARGET_ORG_ID
        	AND TM.TARGET_DIS_ID = TDM.TARGET_ID
		LEFT JOIN T_CODE_DTL CD
			ON TM.PROTOCOL = CD.CLASS_CD_DTL
		LEFT OUTER JOIN T_PERFORM_TERM PT
           	ON PT.PERFORM_CNT = PM.PERFORM_CNT
		WHERE 
           NOT (TM.PROTOCOL = 'PTC03' AND PM.PERFORM_CNT IN (2,3,4))
            <if test="sex !=null and sex != '' ">
		 		AND TM.SEX = #{sex}
		 	</if>
		 	<if test="protocol !=null and protocol != '' ">
				AND  REPLACE(CD.CLASS_CD_DTL_NM," ","")   IN (${protocol})
			</if>
			<if test="disClassDtl !=null and disClassDtl != '' ">
				AND TM.DIS_CLASS_DTL = #{disClassDtl}
			</if>
		GROUP BY
			TM.TARGET_ID
			, TM.TARGET_DIS_ID
			, TM.SEX
			, CD.CLASS_CD_DTL_NM
			, TM.PROTOCOL
			, AGE
 			, PERFORM_NM
			, PM.VISIT_DATE
			, PM.PERFORM_CNT
			, PM.CV_CGI_S
            , PM.CV_CGI_I
            , PM.CV_C_GAS
            , PM.IV4_CGI_S
            , PM.IV4_CGI_I
            , PM.IV4_C_GAS
            , PM.PILL_CNT_KIND
			, PM.PILL_CNT_USED
			, PM.PILL_CNT_TOTAL
			, PM.PILL_CNT_EATEN
            , PM.ARS
			, PM.K_CBCL
			, PM.CBCL
			, PM.DBDS
			, PM.CMRS_P
			, PM.TRAUMA
			, PM.CDI_C
			, PM.IAT
			, PM.K_SCALE
			, PM.RCMAS
			, PM.STAIT_C
			, PM.STAIS_C
			, PM.STAIT_Y
			, PM.STAIS_Y
			, PM.LOI_CV
			, PM.KBIS_11R
			, PM.BDI
			, PM.STAIT_P
			, PM.STAIS_P
			, PM.MBRI
			, PM.KAADHDS_ADULT
			, PM.K_PSI
			, PM.SRS_CLINICAL
			, PM.SRS_4INTERVAL
			, PM.YGTSS_CLINICAL
			, PM.YGTSS_4INTERVAL
            , PM.CYBOCS_4INTERVAL
            , PM.YBOCS
            , PM.YBOCA
            , PM.CYBOCP_4INTERVAL
            ORDER BY TM.TARGET_ID ASC, PM.PERFORM_CNT ASC
            ) A 
            WHERE 1=1
            <if test="targetId !=null and targetId != '' ">
		 		AND UPPER(A.TARGET_ID) = UPPER(#{targetId})
		 		</if>
		 		<if test="targetDisId !=null and targetDisId != '' ">
		 		AND UPPER(A.TARGET_DIS_ID) = UPPER(#{targetDisId})
		 		</if>
		 		<if test="startAge !=null and startAge != '' ">
				AND A.AGE &gt;= #{startAge}
				</if>
				<if test="endAge !=null and endAge != '' ">
				AND A.AGE &lt;= #{endAge}
				</if>
				<if test="performCnt !=null and performCnt != '' ">
		 		AND A.PERFORM_CNT = #{performCnt}
		 		</if>
		 		<if test="cv !=null and cv !='' ">
		 		<if test = 'cv == "Y"'>
		 		AND (A.SRS01 = 'o' OR A.SRS01 = '.') 
		 		AND (A.YGTS1 = 'o' OR A.YGTS1 = '.')
		 		AND (A.YBOCA = 'o' OR A.YBOCA = '.')
		 		AND (A.YBOCS = 'o' OR A.YBOCS = '.')
		 		AND (A.CV_CGI_S != 'x' OR A.CV_CGI_S != '-')
		 		AND (A.CV_CGI_I != 'x' OR A.CV_CGI_I != '-')
		 		AND (A.CV_C_GAS != 'x' OR A.CV_C_GAS != '-')
		 		</if>
		 		</if>
		 		<if test="pSelf !=null and pSelf !='' ">
		 		<if test = 'pSelf == "Y"'>
		 		AND (A.ARS01 = 'o' OR A.ARS01 = '.')
		 		AND (A.KCBCL = 'o' OR A.KCBCL = '.')
		 		AND (A.CBCL1 = 'o' OR A.CBCL1 = '.')
		 		AND (A.DBDS1 = 'o' OR A.DBDS1 = '.')
		 		AND (A.CMRSP = 'o' OR A.CMRSP = '.')
		 		AND (A.TRAUM = 'o' OR A.TRAUM = '.')
		 		</if>
		 		</if>
		 		<if test="cSelf !=null and cSelf !='' ">
		 		<if test = 'cSelf == "Y"'>
		 		AND (CDI01 = 'o' OR CDI01 = '.') 
                AND (IAT01 = 'o' OR IAT01 = '.') 
		 		AND (KSCAL = 'o' OR KSCAL = '.') 
                AND (RCMAS = 'o' OR RCMAS = '.') 
                AND (STITC = 'o' OR STITC = '.') 
                AND (STISC = 'o' OR STISC = '.') 
                AND (STITY = 'o' OR STITY = '.') 
                AND (STISY = 'o' OR STISY = '.') 
                AND (LOICV = 'o' OR LOICV = '.') 
                AND (KBIS1 = 'o' OR KBIS1 = '.') 
		 		</if>
		 		</if>
		 		<if test="pSelf2 !=null and pSelf2 !='' ">
		 		<if test = 'pSelf2 == "Y"'>
		 		AND (BDI01 = 'o' OR BDI01 = '.') 
                AND (STITP = 'o' OR STITP = '.') 
		 		AND (STISP = 'o' OR STISP = '.') 
                AND (MBRI1 = 'o' OR MBRI1 = '.') 
                AND (KADHD = 'o' OR KADHD = '.') 
                AND (KPSI1 = 'o' OR KPSI1 = '.') 
		 		</if>
		 		</if>
		 		<if test="iv4 !=null and iv4 !='' ">
		 		<if test = 'iv4 == "Y"'>
		 		AND (A.SRS02 = 'o' OR A.SRS02 = '.')
                AND (A.YGTS2 = 'o' OR A.YGTS2 = '.')
                AND (A.CYBO2 = 'o' OR A.CYBO2 = '.')
                AND (A.CYBO3 = 'o' OR A.CYBO3 = '.')
                AND (A.IV4_CGI_S != 'x' OR A.IV4_CGI_S != '-') 
		 		AND (A.IV4_CGI_I != 'x' OR A.IV4_CGI_I != '-')
		 		AND (A.IV4_C_GAS != 'x' OR A.IV4_C_GAS != '-')
		 		AND (A.PILL_CNT_USED != 'x' OR A.PILL_CNT_USED != '-')
		 		AND (A.PILL_CNT_KIND != 'x' OR A.PILL_CNT_KIND != '-')
		 		AND (A.PILL_CNT_TOTAL != 'x' OR A.PILL_CNT_TOTAL != '-')
		 		AND (A.PILL_CNT_EATEN != 'x' OR A.PILL_CNT_EATEN != '-')
		 		</if>
		 		</if>
		 		LIMIT #{start}, #{limit}
	</select>
	
	<select id="selectSurveyTotalListTotal"  parameterType="map" resultType="int">
		SELECT COUNT(*) FROM (
			SELECT
			TM.TARGET_ID
			,CASE 
				WHEN TM.SEX = 'F' THEN '여'
				WHEN TM.SEX = 'M' THEN '남'
			END SEX
			,IFNULL(CD.CLASS_CD_DTL_NM, '') PROTOCOL
			, TM.PROTOCOL TP
			,PM.PERFORM_CNT
			,IFNULL(PT.PERFORM_NM,'') PERFORM_NM
			,FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) AGE
			, CONCAT(SUBSTR(PM.VISIT_DATE,1,4) ,'-',SUBSTR(PM.VISIT_DATE,5,2),'-',SUBSTR(PM.VISIT_DATE,7,2)) VISIT_DATE
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.ARS) OR PM.ARS = ''  THEN 'x' WHEN PM.ARS='#' THEN '-' ELSE 'o' END ARS01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.K_CBCL) OR PM.K_CBCL = ''  THEN 'x' WHEN PM.K_CBCL='#' THEN '-' ELSE 'o' END KCBCL
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CBCL) OR PM.CBCL = ''  THEN 'x' WHEN PM.CBCL='#' THEN '-' ELSE 'o' END CBCL1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.DBDS) OR PM.DBDS = ''  THEN 'x' WHEN PM.DBDS='#' THEN '-' ELSE 'o' END DBDS1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CMRS_P) OR PM.CMRS_P = ''  THEN 'x' WHEN PM.CMRS_P='#' THEN '-' ELSE 'o' END CMRSP
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.TRAUMA) OR PM.TRAUMA = ''  THEN 'x' WHEN PM.TRAUMA='#' THEN '-' ELSE 'o' END TRAUM
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CDI_C) OR PM.CDI_C = ''  THEN 'x' WHEN PM.CDI_C='#' THEN '-' ELSE 'o' END CDI01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.IAT) OR PM.IAT  = ''  THEN 'x' WHEN PM.IAT='#' THEN '-' ELSE 'o' END IAT01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.K_SCALE) OR PM.K_SCALE = ''  THEN 'x' WHEN PM.K_SCALE='#' THEN '-' ELSE 'o' END KSCAL
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.RCMAS) OR PM.RCMAS  = ''  THEN 'x' WHEN PM.RCMAS='#' THEN '-' ELSE 'o' END RCMAS
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIT_C) OR PM.STAIT_C = ''  THEN 'x' WHEN PM.STAIT_C='#' THEN '-' ELSE 'o' END STITC
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIS_C) OR PM.STAIS_C = ''  THEN 'x' WHEN PM.STAIS_C='#' THEN '-' ELSE 'o' END STISC
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIT_Y) OR PM.STAIT_Y = ''  THEN 'x' WHEN PM.STAIS_C='#' THEN '-' ELSE 'o' END STITY
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIS_Y) OR PM.STAIS_C = ''  THEN 'x' WHEN PM.STAIS_C='#' THEN '-' ELSE 'o' END STISY
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.LOI_CV) OR PM.LOI_CV = ''  THEN 'x' WHEN PM.LOI_CV='#' THEN '-' ELSE 'o' END LOICV
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.KBIS_11R) OR PM.KBIS_11R = ''  THEN 'x' WHEN PM.KBIS_11R='#' THEN '-' ELSE 'o' END KBIS1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.BDI) OR PM.BDI = ''  THEN 'x' WHEN PM.BDI='#' THEN '-' ELSE 'o' END BDI01
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIT_P) OR PM.STAIT_P = ''  THEN 'x' WHEN PM.STAIT_P='#' THEN '-' ELSE 'o' END STITP
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.STAIS_P) OR PM.STAIS_P = ''  THEN 'x' WHEN PM.STAIS_P='#' THEN '-' ELSE 'o' END STISP
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.MBRI) OR PM.MBRI = ''  THEN 'x' WHEN PM.MBRI='#' THEN '-' ELSE 'o' END MBRI1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.KAADHDS_ADULT) OR PM.KAADHDS_ADULT = ''  THEN 'x' WHEN PM.KAADHDS_ADULT='#' THEN '-' ELSE 'o' END KADHD
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.K_PSI) OR PM.K_PSI = ''  THEN 'x' WHEN PM.K_PSI='#' THEN '-' ELSE 'o' END KPSI1
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.SRS_CLINICAL) OR PM.SRS_CLINICAL = ''  THEN 'x' WHEN PM.SRS_CLINICAL='#' THEN '-' ELSE 'o' END SRS01
            , CASE WHEN ISNULL(PM.SRS_4INTERVAL) OR PM.SRS_4INTERVAL = ''  THEN 'x' WHEN PM.SRS_4INTERVAL='#' THEN '-' ELSE 'o' END SRS02
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.YGTSS_CLINICAL) OR PM.YGTSS_CLINICAL = ''  THEN 'x' WHEN PM.YGTSS_CLINICAL='#' THEN '-' ELSE 'o' END YGTS1
            , CASE WHEN ISNULL(PM.YGTSS_4INTERVAL) OR PM.YGTSS_4INTERVAL = ''  THEN 'x' WHEN PM.YGTSS_4INTERVAL='#' THEN '-' ELSE 'o' END YGTS2
            , CASE WHEN ISNULL(PM.CYBOCS_4INTERVAL) OR PM.CYBOCS_4INTERVAL = ''  THEN 'x' WHEN PM.CYBOCS_4INTERVAL='#' THEN '-' ELSE 'o' END CYBO2
            , CASE WHEN ISNULL(PM.CYBOCP_4INTERVAL) OR PM.CYBOCP_4INTERVAL = ''  THEN 'x' WHEN PM.CYBOCP_4INTERVAL='#' THEN '-' ELSE 'o' END CYBO3
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.YBOCA) OR PM.YBOCA = ''  THEN 'x' WHEN PM.YBOCA='#' THEN '-' ELSE 'o' END YBOCA
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.YBOCS) OR PM.YBOCS = ''  THEN 'x' WHEN PM.YBOCS='#' THEN '-' ELSE 'o' END YBOCS
			, CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CV_CGI_S) THEN 'x' WHEN PM.CV_CGI_S ='#' THEN '-' ELSE PM.CV_CGI_S END CV_CGI_S
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CV_CGI_I) THEN 'x' WHEN PM.CV_CGI_I='#' THEN '-' ELSE PM.CV_CGI_I END CV_CGI_I
            , CASE WHEN PM.PERFORM_CNT IN (2,3) THEN '.' WHEN ISNULL(PM.CV_C_GAS) THEN 'x' WHEN PM.CV_C_GAS='#' THEN '-' ELSE PM.CV_C_GAS END CV_C_GAS
            , CASE WHEN ISNULL(PM.IV4_CGI_S) THEN 'x' WHEN PM.IV4_CGI_S='#' THEN '-' ELSE PM.IV4_CGI_S END IV4_CGI_S
            , CASE WHEN ISNULL(PM.IV4_CGI_I) THEN 'x' WHEN PM.IV4_CGI_I='#' THEN '-' ELSE PM.IV4_CGI_I END IV4_CGI_I
            , CASE WHEN ISNULL(PM.IV4_C_GAS) THEN 'x' WHEN PM.IV4_C_GAS='#' THEN '-' ELSE PM.IV4_C_GAS END IV4_C_GAS
            , IFNULL(PM.PILL_CNT_KIND, 'x') PILL_CNT_KIND
			, IFNULL(PM.PILL_CNT_USED, 'x') PILL_CNT_USED
			, IFNULL(PM.PILL_CNT_TOTAL, 'x') PILL_CNT_TOTAL
			, IFNULL(PM.PILL_CNT_EATEN, 'x') PILL_CNT_EATEN
			FROM T_TARGET_MST TM
			JOIN T_PERFORM_MST PM
	        	ON TM.TARGET_ID = PM.TARGET_ID
	        	AND TM.RND_ID = PM.RND_ID
	        	AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
	        	AND PM.STATUS != '0004'
	        LEFT JOIN T_TARGET_DIS_MST TDM
	        	ON TM.TARGET_ID = TDM.TARGET_ORG_ID
	        	AND TM.TARGET_DIS_ID = TDM.TARGET_ID
			LEFT JOIN T_CODE_DTL CD
				ON TM.PROTOCOL = CD.CLASS_CD_DTL
			LEFT OUTER JOIN T_PERFORM_TERM PT
	           	ON PT.PERFORM_CNT = PM.PERFORM_CNT
			WHERE 
	            NOT (TM.PROTOCOL = 'PTC03' AND PM.PERFORM_CNT IN (2,3,4))
	            <if test="protocol !=null and protocol != '' ">
					AND  REPLACE(CD.CLASS_CD_DTL_NM," ","")   IN (${protocol})
				</if>
				<if test="disClassDtl !=null and disClassDtl != '' ">
					AND TM.DIS_CLASS_DTL = #{disClassDtl}
			</if>
			GROUP BY
				TM.TARGET_ID
				, TM.TARGET_DIS_ID
				, TM.SEX
				, CD.CLASS_CD_DTL_NM
				, TM.PROTOCOL
				, AGE
	 			, PERFORM_NM
				, PM.VISIT_DATE
				, PM.PERFORM_CNT
				, PM.CV_CGI_S
	            , PM.CV_CGI_I
	            , PM.CV_C_GAS
	            , PM.IV4_CGI_S
	            , PM.IV4_CGI_I
	            , PM.IV4_C_GAS
	            , PM.PILL_CNT_KIND
				, PM.PILL_CNT_USED
				, PM.PILL_CNT_TOTAL
				, PM.PILL_CNT_EATEN
	            , PM.ARS
				, PM.K_CBCL
				, PM.CBCL
				, PM.DBDS
				, PM.CMRS_P
				, PM.TRAUMA
				, PM.CDI_C
				, PM.IAT
				, PM.K_SCALE
				, PM.RCMAS
				, PM.STAIT_C
				, PM.STAIS_C
				, PM.STAIT_Y
				, PM.STAIS_Y
				, PM.LOI_CV
				, PM.KBIS_11R
				, PM.BDI
				, PM.STAIT_P
				, PM.STAIS_P
				, PM.MBRI
				, PM.KAADHDS_ADULT
				, PM.K_PSI
				, PM.SRS_CLINICAL
				, PM.SRS_4INTERVAL
				, PM.YGTSS_CLINICAL
				, PM.YGTSS_4INTERVAL
	            , PM.CYBOCS_4INTERVAL
	            , PM.YBOCS
	            , PM.YBOCA
	            , PM.CYBOCP_4INTERVAL) A
				WHERE 1=1
            <if test="targetId !=null and targetId != '' ">
		 		AND UPPER(A.TARGET_ID) = UPPER(#{targetId})
		 		</if>
		 		<if test="targetDisId !=null and targetDisId != '' ">
		 		AND UPPER(A.TARGET_DIS_ID) = UPPER(#{targetDisId})
		 		</if>
				<if test="startAge !=null and startAge != '' ">
				AND A.AGE &gt;= #{startAge}
				</if>
				<if test="endAge !=null and endAge != '' ">
				AND A.AGE &lt;= #{endAge}
				</if>
				<if test="sex !=null and sex != '' ">
		 		AND A.SEX = #{sex}
		 		</if>
				<if test="performCnt !=null and performCnt != '' ">
		 		AND A.PERFORM_CNT = #{performCnt}
		 		</if>
		 		<if test="cv !=null and cv !='' ">
		 		<if test = 'cv == "Y"'>
		 		AND (A.SRS01 = 'o' OR A.SRS01 = '.') 
		 		AND (A.YGTS1 = 'o' OR A.YGTS1 = '.')
		 		AND (A.YBOCA = 'o' OR A.YBOCA = '.')
		 		AND (A.YBOCS = 'o' OR A.YBOCS = '.')
		 		AND (A.CV_CGI_S != 'x' OR A.CV_CGI_S != '-')
		 		AND (A.CV_CGI_I != 'x' OR A.CV_CGI_I != '-')
		 		AND (A.CV_C_GAS != 'x' OR A.CV_C_GAS != '-')
		 		</if>
		 		</if>
		 		<if test="pSelf !=null and pSelf !='' ">
		 		<if test = 'pSelf == "Y"'>
		 		AND (A.ARS01 = 'o' OR A.ARS01 = '.')
		 		AND (A.KCBCL = 'o' OR A.KCBCL = '.')
		 		AND (A.CBCL1 = 'o' OR A.CBCL1 = '.')
		 		AND (A.DBDS1 = 'o' OR A.DBDS1 = '.')
		 		AND (A.CMRSP = 'o' OR A.CMRSP = '.')
		 		AND (A.TRAUM = 'o' OR A.TRAUM = '.')
		 		</if>
		 		</if>
		 		<if test="cSelf !=null and cSelf !='' ">
		 		<if test = 'cSelf == "Y"'>
		 		AND (CDI01 = 'o' OR CDI01 = '.') 
                AND (IAT01 = 'o' OR IAT01 = '.') 
		 		AND (KSCAL = 'o' OR KSCAL = '.') 
                AND (RCMAS = 'o' OR RCMAS = '.') 
                AND (STITC = 'o' OR STITC = '.') 
                AND (STISC = 'o' OR STISC = '.') 
                AND (STITY = 'o' OR STITY = '.') 
                AND (STISY = 'o' OR STISY = '.') 
                AND (LOICV = 'o' OR LOICV = '.') 
                AND (KBIS1 = 'o' OR KBIS1 = '.') 
		 		</if>
		 		</if>
		 		<if test="pSelf2 !=null and pSelf2 !='' ">
		 		<if test = 'pSelf2 == "Y"'>
		 		AND (BDI01 = 'o' OR BDI01 = '.') 
                AND (STITP = 'o' OR STITP = '.') 
		 		AND (STISP = 'o' OR STISP = '.') 
                AND (MBRI1 = 'o' OR MBRI1 = '.') 
                AND (KADHD = 'o' OR KADHD = '.') 
                AND (KPSI1 = 'o' OR KPSI1 = '.') 
		 		</if>
		 		</if>
		 		<if test="iv4 !=null and iv4 !='' ">
		 		<if test = 'iv4 == "Y"'>
		 		AND (A.SRS02 = 'o' OR A.SRS02 = '.')
                AND (A.YGTS2 = 'o' OR A.YGTS2 = '.')
                AND (A.CYBO2 = 'o' OR A.CYBO2 = '.')
                AND (A.CYBO3 = 'o' OR A.CYBO3 = '.')
                AND (A.IV4_CGI_S != 'x' OR A.IV4_CGI_S != '-') 
		 		AND (A.IV4_CGI_I != 'x' OR A.IV4_CGI_I != '-')
		 		AND (A.IV4_C_GAS != 'x' OR A.IV4_C_GAS != '-')
		 		AND (A.PILL_CNT_USED != 'x' OR A.PILL_CNT_USED != '-')
		 		AND (A.PILL_CNT_KIND != 'x' OR A.PILL_CNT_KIND != '-')
		 		AND (A.PILL_CNT_TOTAL != 'x' OR A.PILL_CNT_TOTAL != '-')
		 		AND (A.PILL_CNT_EATEN != 'x' OR A.PILL_CNT_EATEN != '-')
		 		</if>
		 		</if>
	</select>
	
	<update id="deleteSurveyTotalPm" parameterType="map">
		UPDATE T_PERFORM_MST
		SET 
			CV_CGI_S = NULL
			, CV_CGI_I = NULL
			, CV_C_GAS = NULL
			, IV4_CGI_I = NULL
			, IV4_CGI_S = NULL
			, IV4_C_GAS = NULL
			, PILL_CNT_EATEN = NULL
			, PILL_CNT_KIND = NULL
			, PILL_CNT_TOTAL = NULL
			, PILL_CNT_USED = NULL
		WHERE
			TARGET_ID = #{targetId, jdbcType=VARCHAR}
			AND PERFORM_CNT = #{performCnt, jdbcType=NUMERIC}
	</update>
	
	<select id="selectSurveyKcbclList" parameterType="map" resultMap="surveyDtlList">
		SELECT B.* FROM (
			SELECT @ROWNUM := @ROWNUM+1 ROWNUM, A.* FROM (
				SELECT 
					DA.TARGET_ID
					, CASE 
					WHEN TM.SEX = 'F' THEN '여'
					WHEN TM.SEX = 'M' THEN '남'
		                                END SEX
					, CD.CLASS_CD_DTL_NM PROTOCOL
					, DA.PERFORM_CNT
					, PT.PERFORM_NM
					, DA.DOC_ID
					, CONCAT(SUBSTR(PM.VISIT_DATE,1,4) ,'-',SUBSTR(PM.VISIT_DATE,5,2),'-',SUBSTR(PM.VISIT_DATE,7,2)) EXEC_DATE
					, DA.RND_ID
					, FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) AGE
					, CONCAT(DA.CHOICE_ANSWER, '|', CB.CHOICE_ANSWER) CHOICE_ANSWER
					, CONCAT(DA.SUBJECT_ANSWER, '|', CB.SUBJECT_ANSWER) SUBJECT_ANSWER
					, CONCAT(DA.SCORE, '|', CB.SCORE) SCORE
					, CONCAT(DA.REMARKS, '|', CB.REMARKS) REMARKS
					, PM.STATUS
				FROM 
					(SELECT 
							DOC_ID
							, TARGET_ID
							, PERFORM_CNT
							, RND_ID
							, GROUP_CONCAT(CHOICE_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR '|') CHOICE_ANSWER
                            , GROUP_CONCAT(SUBJECT_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SUBJECT_ANSWER
				            , GROUP_CONCAT(SCORE ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SCORE
				            , GROUP_CONCAT(REMARKS ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') REMARKS
                            FROM (
								SELECT 
									DOC_ID
									, TARGET_ID
									, PERFORM_CNT
									, RND_ID
									, INQ_NO
									, CASE WHEN CHOICE_ANSWER IS NULL OR CHOICE_ANSWER = '' THEN 'x' WHEN CHOICE_ANSWER = '#' THEN '-' ELSE CHOICE_ANSWER END CHOICE_ANSWER
									, CASE WHEN SUBJECT_ANSWER IS NULL OR SUBJECT_ANSWER = ' ' THEN 'x' WHEN SUBJECT_ANSWER = '#' THEN '-' ELSE SUBJECT_ANSWER END SUBJECT_ANSWER
									, CASE WHEN SCORE IS NULL OR SCORE = '' THEN 'x' WHEN SCORE = '#' THEN '-' ELSE SCORE END SCORE
									, CASE WHEN REMARKS IS NULL OR REMARKS = '' THEN 'x' WHEN REMARKS = '#' THEN '-' ELSE REMARKS END REMARKS
							FROM 
								T_DOC_ANSWER
					WHERE 1=1                          
						AND DOC_ID = 'KCBCL'
						<if test="schKeyWord !='schTargetId' ">
							<if test="targetId !=null and targetId != '' ">
							 	AND TARGET_ID = #{targetId}
							</if>
							<if test="performCnt !=null and performCnt != '' ">
							 	AND PERFORM_CNT = #{performCnt}
							</if>
						</if>
						) DA1
					GROUP BY
						DOC_ID, TARGET_ID, PERFORM_CNT, RND_ID) DA
				JOIN (SELECT @ROWNUM:=0) AS R
				JOIN
					T_TARGET_MST TM
				ON
					DA.TARGET_ID = TM.TARGET_ID
					AND TM.USE_YN = 'Y'
				LEFT JOIN
					T_CODE_DTL CD
				ON
					TM.PROTOCOL = CD.CLASS_CD_DTL
				JOIN
					T_PERFORM_TERM PT
				ON
					DA.PERFORM_CNT = PT.PERFORM_CNT
				LEFT JOIN
					T_PERFORM_MST PM
				ON
					DA.TARGET_ID = PM.TARGET_ID
					AND DA.PERFORM_CNT = PM.PERFORM_CNT
					AND DA.RND_ID = PM.RND_ID
				LEFT JOIN
					(SELECT 
							DOC_ID
							, TARGET_ID
							, PERFORM_CNT
							, RND_ID
							, GROUP_CONCAT(CHOICE_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR '|') CHOICE_ANSWER
                            , GROUP_CONCAT(SUBJECT_ANSWER ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SUBJECT_ANSWER
				            , GROUP_CONCAT(SCORE ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') SCORE
				            , GROUP_CONCAT(REMARKS ORDER BY TARGET_ID, PERFORM_CNT, INQ_NO SEPARATOR  '|') REMARKS
                            FROM (
								SELECT 
									DOC_ID
									, TARGET_ID
									, PERFORM_CNT
									, RND_ID
									, INQ_NO
									, CASE WHEN CHOICE_ANSWER IS NULL OR CHOICE_ANSWER = '' THEN 'x' WHEN CHOICE_ANSWER = '#' THEN '-' ELSE CHOICE_ANSWER END CHOICE_ANSWER
									, CASE WHEN SUBJECT_ANSWER IS NULL OR SUBJECT_ANSWER = ' ' THEN 'x' WHEN SUBJECT_ANSWER = '#' THEN '-' ELSE SUBJECT_ANSWER END SUBJECT_ANSWER
									, CASE WHEN SCORE IS NULL OR SCORE = '' THEN 'x' WHEN SCORE = '#' THEN '-' ELSE SCORE END SCORE
									, CASE WHEN REMARKS IS NULL OR REMARKS = '' THEN 'x' WHEN REMARKS = '#' THEN '-' ELSE REMARKS END REMARKS
							FROM 
								T_DOC_ANSWER
					WHERE 1=1
						AND DOC_ID = 'CBCL1'
						<if test="schKeyWord !='schTargetId' ">
							<if test="targetId !=null and targetId != '' ">
							 	AND TARGET_ID = #{targetId}
							</if>
							<if test="performCnt !=null and performCnt != '' ">
							 	AND PERFORM_CNT = #{performCnt}
							</if>
						</if>
						) DA1
					GROUP BY
						DOC_ID, TARGET_ID, PERFORM_CNT, RND_ID) CB
					ON
						DA.TARGET_ID = CB.TARGET_ID
						AND DA.PERFORM_CNT = CB.PERFORM_CNT
						AND DA.RND_ID = CB.RND_ID
		            WHERE 1=1       
		            <if test="schKeyWord !='schTargetId' ">                     
			          	<if test="targetId !=null and targetId != '' ">
							AND UPPER(DA.TARGET_ID) = UPPER(#{targetId})
						</if>
			            <if test="docId !=null and docId != '' ">
							AND DA.DOC_ID = #{docId}
			            </if>
						<if test="startAge !=null and startAge != '' ">
						AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &gt;= #{startAge}
						</if>
						<if test="endAge !=null and endAge != '' ">
						AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &lt;= #{endAge}
						</if>
						<if test="sex !=null and sex != '' ">
							AND TM.SEX = #{sex}
						</if>
						<if test="protocol !=null and protocol != '' ">
							AND  REPLACE(CD.CLASS_CD_DTL_NM," ","")   IN (${protocol})
						</if>
						<if test="performCnt !=null and performCnt != '' ">
							AND DA.PERFORM_CNT = #{performCnt}
						</if>    
						<if test="performNm !=null and performNm != '' ">
					 		AND PT.PERFORM_NM = #{performNm}
					 	</if> 
					 </if>
				ORDER BY
					DA.TARGET_ID, DA.PERFORM_CNT
				) A
			)B
			WHERE 1=1
			AND B.STATUS != '0004'
			<if test="schKeyWord == 'schTargetId' ">
				AND TARGET_ID = #{targetId}
				AND PERFORM_CNT = ${performCnt}
			</if> 
		LIMIT #{start}, #{limit}
	</select>
	
	<select id="selectSurveyKcbclListTotal" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM (
            SELECT @ROWNUM := @ROWNUM+1 ROWNUM, A.* FROM (
                SELECT 
                    DA.TARGET_ID,
                    PM.STATUS
                FROM 
                    (SELECT 
                        DOC_ID
                        , TARGET_ID
                        , PERFORM_CNT
                        , RND_ID
                    FROM 
                        T_DOC_ANSWER
                    WHERE 1=1                          
                        AND DOC_ID = 'KCBCL'
                        <if test="schKeyWord !='schTargetId' ">
                            <if test="targetId !=null and targetId != '' ">
                                 AND TARGET_ID = #{targetId}
                            </if>
                            <if test="performCnt !=null and performCnt != '' ">
                                 AND PERFORM_CNT = #{performCnt}
                            </if>
                        </if>
                    GROUP BY
                        DOC_ID, TARGET_ID, PERFORM_CNT, RND_ID) DA
                JOIN (SELECT @ROWNUM:=0) AS R
                JOIN
                    T_TARGET_MST TM
                ON
                    DA.TARGET_ID = TM.TARGET_ID
                    AND TM.USE_YN = 'Y'
                LEFT JOIN
                    T_CODE_DTL CD
                ON
                    TM.PROTOCOL = CD.CLASS_CD_DTL
                JOIN
                    T_PERFORM_TERM PT
                ON
                    DA.PERFORM_CNT = PT.PERFORM_CNT
                LEFT JOIN
                    T_PERFORM_MST PM
                ON
                    DA.TARGET_ID = PM.TARGET_ID
                    AND DA.PERFORM_CNT = PM.PERFORM_CNT
                    AND DA.RND_ID = PM.RND_ID
                LEFT JOIN
                    (SELECT 
                        DOC_ID
                        , TARGET_ID
                        , PERFORM_CNT
                        , RND_ID
                    FROM 
                        T_DOC_ANSWER
                    WHERE 1=1
                        AND DOC_ID = 'CBCL1'
                        <if test="schKeyWord !='schTargetId' ">
                            <if test="targetId !=null and targetId != '' ">
                                 AND TARGET_ID = #{targetId}
                            </if>
                            <if test="performCnt !=null and performCnt != '' ">
                                 AND PERFORM_CNT = #{performCnt}
                            </if>
                        </if>
                    GROUP BY
                        DOC_ID, TARGET_ID, PERFORM_CNT, RND_ID) CB
                    ON
                        DA.TARGET_ID = CB.TARGET_ID
                        AND DA.PERFORM_CNT = CB.PERFORM_CNT
                        AND DA.RND_ID = CB.RND_ID
                    WHERE 1=1       
                    <if test="schKeyWord !='schTargetId' ">                     
                          <if test="targetId !=null and targetId != '' ">
                            AND UPPER(DA.TARGET_ID) = UPPER(#{targetId})
                        </if>
                        <if test="docId !=null and docId != '' ">
                            AND DA.DOC_ID = #{docId}
                        </if>
                        <if test="startAge !=null and startAge != '' ">
                        AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &gt;= #{startAge}
                        </if>
                        <if test="endAge !=null and endAge != '' ">
                        AND FN_CAL_AGE(TM.BIRTH_YM, PM.VISIT_DATE) &lt;= #{endAge}
                        </if>
                        <if test="sex !=null and sex != '' ">
                            AND TM.SEX = #{sex}
                        </if>
                        <if test="protocol !=null and protocol != '' ">
                            AND  REPLACE(CD.CLASS_CD_DTL_NM," ","")   IN (${protocol})
                        </if>
                        <if test="performCnt !=null and performCnt != '' ">
                            AND DA.PERFORM_CNT = #{performCnt}
                        </if>    
                        <if test="performNm !=null and performNm != '' ">
                             AND PT.PERFORM_NM = #{performNm}
                         </if> 
                     </if>
                ORDER BY
                    DA.TARGET_ID, DA.PERFORM_CNT
                ) A
            )B
            WHERE 1=1
            AND B.STATUS != '0004'
            <if test="schKeyWord == 'schTargetId' ">
                AND TARGET_ID = #{targetId}
                AND PERFORM_CNT = ${performCnt}
            </if> 
	</select>
	
	<update id="updatePerformMst" parameterType="map">
		
		UPDATE T_PERFORM_MST
		SET
			<if test="surveyKind =='ARS01'">
				ARS = #{execDate}
				, ARS_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='SRS01'">
				SRS_CLINICAL = #{execDate}
				, SRS_CLINICAL_DATE = #{surveyExecDate}
			</if>			
			<if test="surveyKind =='SRS02'">
				SRS_4INTERVAL = #{execDate}
				, SRS_4INTERVAL_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='KCBCL'">
				K_CBCL = #{execDate}
				, K_CBCL_DATE = #{surveyExecDate}	
			</if>
			<if test="surveyKind =='CBCL1'">
				CBCL = #{execDate}
				, CBCL_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='DBDS1'">
				DBDS = #{execDate}
				, DBDS_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='CMRSP'">
				CMRS_P = #{execDate}
				, CMRS_P_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='TRAUM'">
				TRAUMA = #{execDate}
				, TRAUMA_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='CDI01'">
				CDI_C = #{execDate}
				, CDI_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='ITA01'">
				ITA = #{execDate}
				, IAT_DATE = #{surveyExecDate}
			</if>			
			<if test="surveyKind =='RCMAS'">
				RCMAS = #{execDate}
				, RCMAS_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='KSCAL'">
				K_SCALE = #{execDate}
				, K_SCALE_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='STITC'">
				STAIT_C = #{execDate}
				, STAIT_C_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='STISC'">
				STAIS_C = #{execDate}
				, STAIS_C_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='STITY'">
				STAIT_Y = #{execDate}
				, STAIT_Y_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='STISY'">
				STAIS_Y = #{execDate}
				, STAIS_Y_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='LOICV'">
				LOI_CV = #{execDate}
				, LOI_CV_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='KBIS1'">
				KBIS_11R = #{execDate}
				, KBIS_11R_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='BDI01'">
				BDI = #{execDate}
				, BDI_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='STITP'">
				STAIT_P = #{execDate}
				, STAIT_P_DATE = #{surveyExecDate} 
			</if>
			<if test="surveyKind =='STISP'">
				STAIS_P = #{execDate}
				, STAIS_P_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='IAT01'">
				IAT = #{execDate}
				, IAT_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='MBRI1'">
				MBRI = #{execDate}
				, MBRI_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='KADHD'">
				KAADHDS_ADULT = #{execDate}
				, KAADHDS_ADULT_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='KPSI1'">
				K_PSI = #{execDate}
				, K_PSI_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='CYBO2'">
				CYBOCS_4INTERVAL = #{execDate}
				, CYBOCS_4INTERVAL_DATE = #{surveyExecDate}
			</if>
			<if test="surveyKind =='YBOCS'">
				YBOCS = #{execDate}
				, YBOCS_DATE = #{surveyExecDate}		
			</if>
			<if test="surveyKind =='YBOCA'">
				YBOCA = #{execDate}
				, YBOCA_DATE = #{surveyExecDate}		
			</if>
			<if test="surveyKind =='YGTS1'">
				YGTSS_CLINICAL = #{execDate}
				, YGTSS_CLINICAL_DATE = #{surveyExecDate}		
			</if>
			<if test="surveyKind =='YGTS2'">
				YGTSS_4INTERVAL = #{execDate}
				, YGTSS_4INTERVAL_DATE = #{surveyExecDate}		
			</if>
			<if test="surveyKind =='CYBO3'">
				CYBOCP_4INTERVAL_DATE = #{surveyExecDate}	
			</if>
		WHERE 1=1
				AND TARGET_ID = #{targetId}
				AND PERFORM_CNT = #{performCnt}
				AND RND_ID = #{rndId}
				AND DIS_CLASS_DTL = #{disClassDtl} 
				
	</update>
	<update id="updateSurveyPerformMstTotal" parameterType="map">
		
		UPDATE T_PERFORM_MST SET
			ARS = NULL
			,K_CBCL = NULL
            ,CBCL = NULL
            ,DBDS = NULL
            ,CMRS_P = NULL
            ,TRAUMA = NULL
            ,CDI_C = NULL
            ,K_SCALE = NULL
            ,RCMAS = NULL
            ,STAIT_C = NULL
            ,STAIS_C = NULL
			,STAIT_Y = NULL
			,STAIS_Y = NULL
            ,LOI_CV = NULL
            ,KBIS_11R = NULL
            ,BDI = NULL
            ,STAIT_P = NULL
			,STAIS_P = NULL
            ,IAT = NULL
            ,MBRI = NULL
            ,KAADHDS_ADULT = NULL
			,K_PSI = NULL
			,CLINICAL_VALUATION = NULL
			,4INTERVAL_INTERVIEW = NULL
			,SRS_CLINICAL = NULL
			,SRS_4INTERVAL = NULL
			,YGTSS_CLINICAL = NULL
			,YGTSS_4INTERVAL = NULL
			,CYBOCS_4INTERVAL = NULL
			,YBOCS = NULL
			,YBOCA = NULL
		WHERE 1=1
			AND TARGET_ID = #{targetId}
			AND PERFORM_CNT = #{performCnt}
		
	</update>
	
	<update id="updateSurveyPerformMst" parameterType="map">
		UPDATE T_PERFORM_MST SET
		
			<if test="docId =='ARS01'">
				ARS = NULL
			</if>
			<if test="docId =='KCBCL'">
				K_CBCL = NULL
			</if>
			<if test="docId =='CBCL1'">
				CBCL = NULL
			</if>
			<if test="docId =='DBDS1'">
				DBDS = NULL
			</if>
			<if test="docId =='CMRSP'">
				CMRS_P = NULL
			</if>
			<if test="docId =='TRAUM'">
				TRAUMA = NULL
			</if>
			<if test="docId =='CDI01'">
				CDI_C = NULL
			</if>
			<if test="docId =='ITA01'">
				ITA = NULL
			</if>			
			<if test="docId =='RCMAS'">
				RCMAS = NULL
			</if>
			<if test="docId =='KSCAL'">
				K_SCALE = NULL
			</if>
			<if test="docId =='STITC'">
				STAIT_C = NULL
			</if>
			<if test="docId =='STISC'">
				STAIS_C = NULL
			</if>
			<if test="docId =='STITY'">
				STAIT_Y = NULL
			</if>
			<if test="docId =='STISY'">
				STAIS_Y = NULL
			</if>
			<if test="docId =='LOICV'">
				LOI_CV = NULL
			</if>
			<if test="docId =='KBIS1'">
				KBIS_11R = NULL
			</if>
			<if test="docId =='BDI01'">
				BDI = NULL
			</if>
			<if test="docId =='STITP'">
				STAIT_P = NULL
			</if>
			<if test="docId =='STISP'">
				STAIS_P = NULL
			</if>
			<if test="docId =='IAT01'">
				IAT = NULL
			</if>
			<if test="docId =='MBRI1'">
				MBRI = NULL
			</if>
			<if test="docId =='KADHD'">
				KAADHDS_ADULT = NULL
			</if>
			<if test="docId =='KPSI1'">
				K_PSI = NULL
			</if>
			<if test="docId =='SRS01'">
				SRS_CLINICAL = NULL
			</if>
			<if test="docId =='SRS02'">
				SRS_4INTERVAL = NULL
			</if>
			<if test="docId =='YGTS1'">
				YGTSS_CLINICAL = NULL
			</if>
			<if test="docId =='YGTS2'">
				YGTSS_4INTERVAL = NULL
			</if>
			<if test="docId =='CYBO1'">
				CYBOCS_4INTERVAL = NULL
			</if>
			<if test="docId =='YBOCS'">
				YBOCS = NULL
			</if>
			<if test="docId =='YBOCA'">
				YBOCA = NULL
			</if>
			WHERE 1=1 
			AND TARGET_ID = #{targetId}
			AND PERFORM_CNT = #{performCnt}
	</update>
	
</mapper>