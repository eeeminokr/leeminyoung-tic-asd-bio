<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Main">

	<resultMap id="memberMap" type="MemberVO">
		<result property="idx"       		column="IDX" />
		<result property="userId"         	column="USER_ID" />
		<result property="userPwd"      	column="USER_PWD" />
		<result property="menuId"         	column="MENU_ID" />
		<result property="menuNm"      		column="MENU_NM" />
		<result property="rndId"         	column="RND_ID" />
		<result property="userNm"       	column="USER_NM" />
		<result property="userAuth"       	column="USER_AUTH" />
		<result property="userAuthNm"      	column="USER_AUTH_NM" />
		<result property="userInstCd"       column="USER_INST_CD" />
		<result property="userInstCdNm"     column="USER_INST_CD_NM" />
		<result property="phoneNum"      	column="PHONE_NUM" />
		<result property="email"      		column="EMAIL" />
		<result property="remarks"     		column="REMARKS" />
		<result property="useYn"      		column="USE_YN" />
		<result property="deptNm"      		column="DEPT_NM" />
		<result property="grdNm"      		column="GRD_NM" />
		<result property="insertYn"    		column="INSERT_YN" />
		<result property="selectYn"    		column="SELECT_YN" />
		<result property="modifyYn"    		column="MODIFY_YN" />
		<result property="deleteYn"    		column="DELETE_YN" />
		<result property="uploadYn"    		column="UPLOAD_YN" />
		<result property="downYn"      		column="DOWN_YN" />
		<result property="instTargetCd"     column="INST_TARGET_CD" />
		<result property="createDate"     	column="CREATE_DATE" />
		<result property="updateDate"     	column="UPDATE_DATE" />
	</resultMap>	
	
	<resultMap id="dashboardMap" type="dashboardVO">
		<result property="yyyy"      		column="YYYY" />
		<result property="protocol"      	column="PROTOCOL" />
		<result property="status"      		column="STATUS" />
		<result property="performCnt"      	column="PERFORM_CNT" />
		<result property="performNm"      	column="PERFORM_NM" />
		<result property="classCdDtlNm"      	column="CLASS_CD_DTL_NM" />
		<result property="classCdDtl"      	column="CLASS_CD_DTL" />
		
		<result property="pcount"       		column="PCOUNT" />
		<result property="yyyyTotal"       		column="YYYY_TOTAL" />
		
		<result property="ptc01"       		column="PTC01" />
		<result property="ptc02"         	column="PTC02" />
		<result property="ptc03"      		column="PTC03" />
		
		<result property="s3pc1"      	column="S3PC1" />
		<result property="s2pc1"      	column="S2PC1" />
		<result property="s4pc2"      	column="S4PC2" />
		<result property="s3pc2"      	column="S3PC2" />
		<result property="s2pc2"      	column="S2PC2" />
		<result property="s4pc3"      	column="S4PC3" />
		<result property="s3pc3"      	column="S3PC3" />
		<result property="s2pc3"      	column="S2PC3" />
		<result property="s4pc4"      	column="S4PC4" />
		<result property="s3pc4"      	column="S3PC4" />
		<result property="s2pc4"      	column="S2PC4" />
		<result property="s4pc5"      	column="S4PC5" />
		<result property="s3pc5"      	column="S3PC5" />
		<result property="s2pc5"      	column="S2PC5" />
		<result property="s1pc5"      	column="S1PC5" />
		<result property="s4pc6"      	column="S4PC6" />
		<result property="s3pc6"      	column="S3PC6" />
		<result property="s2pc6"      	column="S2PC6" />
		<result property="s1pc6"      	column="S1PC6" />
		<result property="s4pc7"      	column="S4PC7" />
		<result property="s3pc7"      	column="S3PC7" />
		<result property="s2pc7"      	column="S2PC7" />
		<result property="s1pc7"      	column="S1PC7" />
	</resultMap>
	
	
	<select id="selectMember" parameterType="map" resultMap="memberMap">
		SELECT
			UM.IDX,
			UM.USER_ID,
			UM.USER_PWD,
			UM.RND_ID,
			UM.USER_NM,
			UM.AUTH_CD 				USER_AUTH,
            GA.AUTH_NM				USER_AUTH_NM,
            CD.CLASS_CD_DTL 		USER_INST_CD,
            CD.CLASS_CD_DTL_NM 		USER_INST_CD_NM,
			UM.DEPT_NM,
			UM.GRD_NM,
			UM.PHONE_NUM,
			UM.EMAIL,
			UM.REMARKS,
			UM.USE_YN,
			DATE_FORMAT(UM.CREATE_DATE, "%Y-%m-%d %H:%i:%s")	CREATE_DATE,
			DATE_FORMAT(UM.UPDATE_DATE, "%Y-%m-%d %H:%i:%s")	UPDATE_DATE
		FROM 
			T_USER_MST UM
		JOIN
			T_GRP_AUTH GA
		ON
			UM.AUTH_CD = GA.AUTH_CD
        LEFT JOIN
			(SELECT 
				AM.USER_AUTH,
                AM.USER_ID,
                CD.CLASS_CD_DTL_NM USER_AUTH_NM
			FROM 
				T_AUTH_MST AM
			JOIN
				T_CODE_DTL CD
			ON
				AM.USER_AUTH = CD.CLASS_CD_DTL
				AND CD.CLASS_CD = 'AU001') UA
		ON 
			UM.USER_ID = UA.USER_ID
		LEFT JOIN
			T_CODE_DTL CD
		ON
			UM.USER_INST_CD = CD.CLASS_CD_DTL
			AND CD.CLASS_CD = 'IS001'
		WHERE 1=1
			<if test="userId !=null and userId != '' ">
				AND UM.USER_ID= #{userId}
			</if>
			AND UM.USE_YN = 'Y'
	</select>
	
	<select id="selectGrpAuth" parameterType="map" resultMap="memberMap">
		SELECT
			AUTH_CD		USER_AUTH
			, AUTH_NM	USER_AUTH_NM
			, INSERT_YN
			, SELECT_YN
			, MODIFY_YN
			, DELETE_YN
			, UPLOAD_YN
			, DOWN_YN
		FROM 
			T_GRP_AUTH
		WHERE 1=1
			<if test="userAuth !=null and userAuth!= '' ">
				AND AUTH_CD = #{userAuth}
			</if>
		ORDER BY AUTH_CD
	</select>
	
	<select id="selectMenuList" parameterType="map" resultMap="memberMap">
		SELECT
			MENU_ID
			, MENU_NM
		FROM 
			T_MENU
		WHERE
			USING_YN = 'Y'
		ORDER BY SORT_NO
	</select>
	
	
	<update id="updateUser" parameterType="map">
        UPDATE 
       		T_USER_MST 
       	SET 
        	DEPT_NM = #{deptNm}
        	, PHONE_NUM = #{phoneNum}
        	, EMAIL = #{email}
        	<if test="userInstCd !=null and userInstCd != '' ">
				, AUTH_CD = #{userAuth}
			</if>
			<if test="userInstCd !=null and userInstCd != '' ">
				, USER_INST_CD = #{userInstCd}
			</if>
			<if test="userNm !=null and userNm != '' ">
				, USER_NM = #{userNm}
			</if>
			, UPDATE_DATE = now()
			, UPDATE_by = #{updateBy}
       	WHERE 
       		USER_ID = #{userId}
    </update>
    
    <update id="updatePwd" parameterType="map">
        UPDATE 
        	T_USER_MST 
        SET 
        	USER_PWD = #{userPwd, jdbcType=VARCHAR}
        WHERE 
        	USER_ID = #{userId, jdbcType=VARCHAR}
    </update>
    
   	<update id="insertUser" parameterType="map">
        INSERT INTO T_USER_MST(
        	IDX
        	,USER_ID
        	,USER_PWD
        	,RND_ID
        	,USER_NM
        	,USER_INST_CD
			,DEPT_NM
			,GRD_NM
        	,PHONE_NUM
        	,EMAIL
        	,AUTH_CD
			,USE_YN
			,REMARKS
			,CREATE_DATE
			,CREATE_BY
			,UPDATE_DATE
			,UPDATE_BY
        	) VALUES (
        		 #{idx , jdbcType=VARCHAR}
				, #{userId , jdbcType=VARCHAR}
				, #{userPwd , jdbcType=VARCHAR}
				, (SELECT RND_ID FROM T_RND_MST ORDER BY RND_ID	LIMIT 0,1)
				, #{userNm , jdbcType=VARCHAR}
				, #{userInstCd , jdbcType=VARCHAR}
				, #{deptNm , jdbcType=VARCHAR}
				, #{grdNm , jdbcType=VARCHAR}
				, #{phoneNum , jdbcType=VARCHAR}
				, #{email , jdbcType=VARCHAR}
				, #{userAuth , jdbcType=VARCHAR}
				, #{useYn , jdbcType=VARCHAR}
				, #{remarks , jdbcType=VARCHAR}
				, now()
				, #{createBy , jdbcType=VARCHAR}
				, now()
				, #{createBy , jdbcType=VARCHAR}
        	)
    </update>
    
    <update id="insertUserAuth" parameterType="map">
        INSERT INTO T_AUTH_MST(
        	USER_ID
        	, USER_AUTH
			, CREATE_DATE
			, CREATE_BY
			, UPDATE_DATE
			, UPDATE_BY
        	) VALUES (
        		 #{userId, jdbcType=VARCHAR}
				, #{userAuth, jdbcType=VARCHAR}
				, now()
				, #{createBy, jdbcType=VARCHAR}
				, now()
				, #{updateBy, jdbcType=VARCHAR}
        	)
    </update>
    
    <update id="insertUserMenuAuth" parameterType="map">
    	INSERT INTO T_USER_AUTH(
    		MENU_ID
    		, USER_ID
    		, INSERT_YN
    		, SELECT_YN
    		, MODIFY_YN
    		, DELETE_YN
    		, UPLOAD_YN
    		, DOWN_YN
    		, CREATE_DATE
    		, CREATE_BY
    		, UPDATE_DATE
    		, UPDATE_BY
    	)VALUES(
    		#{menuId, jdbcType=VARCHAR}
    		, #{userId, jdbcType=VARCHAR}
    		, #{insertYn, jdbcType=CHAR}
    		, #{selectYn, jdbcType=CHAR}
    		, #{modifyYn, jdbcType=CHAR}
    		, #{deleteYn, jdbcType=CHAR}
    		, #{uploadYn, jdbcType=CHAR}
    		, #{downYn, jdbcType=CHAR}
    		, NOW()
    		, #{createBy, jdbcType=VARCHAR}
    		, NOW()
    		, #{updateBy, jdbcType=VARCHAR}
    	)
    	ON DUPLICATE KEY UPDATE
    		INSERT_YN = #{insertYn, jdbcType=CHAR}
    		, INSERT_YN = #{insertYn, jdbcType=CHAR}
    		, SELECT_YN = #{selectYn, jdbcType=CHAR}
    		, MODIFY_YN = #{modifyYn, jdbcType=CHAR}
    		, DELETE_YN = #{deleteYn, jdbcType=CHAR}
    		, UPLOAD_YN = #{uploadYn, jdbcType=CHAR}
    		, DOWN_YN = #{downYn, jdbcType=CHAR}
    		, UPDATE_DATE = NOW()
    		, UPDATE_BY = #{updateBy , jdbcType=VARCHAR}
    </update>
    
    <select id="uniqueUserId" parameterType="map" resultType="int">
		SELECT
			COUNT(*) AS TOTAL_CNT
		FROM T_USER_MST
		WHERE 1=1
			AND USER_ID = #{userId}
	</select>
    
    <delete id="deleteUser" parameterType="map">
		DELETE
		FROM T_USER_MST
		WHERE 1=1
			AND USER_ID = #{userId}
	</delete>
    
    <delete id="deleteUserAuth" parameterType="map">
		DELETE
		FROM T_AUTH_MST
		WHERE 1=1
			AND USER_ID = #{userId}
	</delete>
    
    <delete id="deleteUserMenuAuth" parameterType="map">
		DELETE
		FROM T_USER_AUTH
		WHERE 
			USER_ID = #{userId}
	</delete>
	
	<select id="selectDashboardData" parameterType="map" resultMap="dashboardMap">
		SELECT 
			@ptc01_v := PTC.PTC01 + @ptc01_v AS PTC01
			, @ptc02_v := PTC.PTC02 + @ptc02_v AS PTC02
			, @ptc03_v := PTC.PTC03 + @ptc03_v AS PTC03
			, PTC.YYYY
		FROM
			(SELECT
				IFNULL(SUM(IF(B.PROTOCOL = 'PTC01', BCOUNT, NULL)), 0) AS PTC01
				, IFNULL(SUM(IF(B.PROTOCOL = 'PTC02', BCOUNT, NULL)), 0) AS PTC02
				, IFNULL(SUM(IF(B.PROTOCOL = 'PTC03', BCOUNT, NULL)), 0)  AS PTC03
				, B.YYYY
			FROM (
				SELECT A.PROTOCOL, A.YYYY, COUNT(*) AS BCOUNT 
				FROM(
					SELECT 
						TM.PROTOCOL
						, SUBSTR(PM.VISIT_DATE, 1,4) YYYY
						, PM.VISIT_DATE YYYYMM
						, PM.PERFORM_CNT
						, TM.DIS_CLASS_DTL
					FROM T_TARGET_MST TM
						JOIN T_PERFORM_MST PM
						ON TM.TARGET_ID = PM.TARGET_ID
						AND TM.USE_YN = 'Y'
						AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
						AND TM.RND_ID = 1
					WHERE PM.PERFORM_CNT = 1
						AND TM.DIS_CLASS_DTL = #{classCdDtl}
			) A
			GROUP BY A.PROTOCOL, A.YYYY
		) B
		WHERE B.YYYY &lt;= YEAR(NOW())
		GROUP BY B.YYYY
		ORDER BY B.YYYY) PTC
		CROSS JOIN (SELECT @ptc01_v := 0, @ptc02_v := 0, @ptc03_v := 0) t2
	</select>
	
	<select id="selectDashboardBarData" parameterType="map" resultMap="dashboardMap">
   
   SELECT 
		YYYY
		, SUM(PCOUNT) AS PCOUNT
		, CASE CLASS_CD_DTL 
			WHEN 'PTC03' THEN CONCAT(B.YYYY,'비약물군')
			WHEN 'PTC01' THEN CONCAT(B.YYYY,'약물(단기)') 
			WHEN 'PTC02' THEN CONCAT(B.YYYY,'약물(장기)') 
		END CLASS_CD_DTL
	FROM (
		SELECT 
			A.SEX
			, A.PROTOCOL
			, CD.CLASS_CD_DTL
			, A.YYYY
			, CASE WHEN PROTOCOL = CD.CLASS_CD_DTL THEN COUNT(*) ELSE 0 END PCOUNT
  		FROM (
			SELECT 
			   TM.PROTOCOL
			   , CASE TM.SEX WHEN 'F' THEN '여' ELSE '남' END SEX
			   , SUBSTR(PM.VISIT_DATE, 1,4) YYYY
			FROM T_TARGET_MST TM
			JOIN T_PERFORM_MST PM
			   ON TM.TARGET_ID = PM.TARGET_ID
			   AND TM.USE_YN = 'Y'
			   AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
			   AND TM.RND_ID = 1
			 WHERE PM.PERFORM_CNT = 1
			 	AND TM.DIS_CLASS_DTL = #{classCdDtl}
    	) A
	   JOIN T_CODE_DTL CD
	   ON CD.CLASS_CD = 'PT001'
	   GROUP BY A.PROTOCOL, A.YYYY, A.SEX, CD.CLASS_CD_DTL
	) B 
   GROUP BY  CLASS_CD_DTL, YYYY 
   ORDER BY YYYY
   , (CASE CLASS_CD_DTL WHEN 'PTC03' THEN 1 WHEN 'PTC01' THEN 2 WHEN 'PTC02' THEN 3 ELSE 4 END)


	</select>
	
	<select id="selectDashboardBarDataTotal" parameterType="map" resultMap="dashboardMap">
   
		SELECT COUNT(
			CASE WHEN TM.PROTOCOL != 'PTC02' AND TM.PROTOCOL != 'PTC03' AND TM.PROTOCOL != 'PTC01' THEN NULL ELSE TM.PROTOCOL END) YYYY_TOTAL
			, SUBSTR(PM.VISIT_DATE, 1,4) YYYY
		FROM T_TARGET_MST TM
		JOIN T_PERFORM_MST PM
			ON TM.TARGET_ID = PM.TARGET_ID
			AND TM.USE_YN = 'Y'
			AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
			AND TM.RND_ID = 1
		WHERE PM.PERFORM_CNT = 1
			AND TM.DIS_CLASS_DTL = #{classCdDtl}
        GROUP BY YYYY
		ORDER BY YYYY

	</select>
	
	<select id="selectMaxPerformCnt" parameterType="map" resultMap="dashboardMap">
		SELECT 
			MAX(PERFORM_CNT) AS PERFORM_CNT
        	, GROUP_CONCAT(PERFORM_NM) AS PERFORM_NM
		FROM T_PERFORM_TERM
        WHERE PERFORM_CNT NOT IN (1,2,3,4)
	</select>
	
	<select id="selectMaxPerformCntAsd" parameterType="map" resultMap="dashboardMap">
		SELECT 
			MAX(PERFORM_CNT) AS PERFORM_CNT
        	, GROUP_CONCAT(PERFORM_NM) AS PERFORM_NM
		FROM T_PERFORM_TERM
        WHERE PERFORM_CNT NOT IN (1,2,3,4,8)
	</select>
	
	<select id="selectDashboardList" parameterType="map" resultMap="dashboardMap">
		

<!-- SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
				GROUP BY 
					A.PROTOCOL
					,A.CLASS_CD_DTL_NM
					,A.STATUS
					,A.SEX
					,A.PERFORM_CNT
			)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'M'
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
		AND B.PERFORM_CNT NOT IN (2, 3, 4)
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
			A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
			A.PROTOCOL
			,A.CLASS_CD_DTL_NM
			,A.STATUS
			,A.SEX
			,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
			,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
		
		UNION
		
		SELECT 
			IF(COUNT(B.CLASS_CD_DTL_NM) > 0, 'TIC군 총합', 'TIC군 총합') CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '셀삭제', '셀삭제') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
			)B -->
			
			
			
			SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
	 		, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
				WHERE A.DIS_CLASS_DTL = #{classCdDtl}
				GROUP BY 
					A.PROTOCOL
					,A.CLASS_CD_DTL_NM
					,A.STATUS
					,A.SEX
					,A.PERFORM_CNT
			)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'M'
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}		
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
	 		, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
		AND B.PERFORM_CNT NOT IN (2, 3, 4)
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
			A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
			A.PROTOCOL
			,A.CLASS_CD_DTL_NM
			,A.STATUS
			,A.SEX
			,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
	 		, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
			,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
		
		UNION
		
		SELECT 
			IF(COUNT(B.CLASS_CD_DTL_NM) > 0, CASE WHEN B.DIS_CLASS_DTL = 'DS001' THEN 'TIC군 총합'
											WHEN B.DIS_CLASS_DTL = 'DS003' THEN 'ASD군 총합' END, CASE WHEN B.DIS_CLASS_DTL = 'DS001' THEN 'TIC군 총합'
											WHEN B.DIS_CLASS_DTL = 'DS003' THEN 'ASD군 총합' END) CLASS_CD_DTL_NM_NO
			, IF(COUNT(B.SEX) > 0, '셀삭제', '셀삭제') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
			)B
			GROUP BY B.DIS_CLASS_DTL
	</select>
	
	<select id="selectDashboardListAsd" parameterType="map" resultMap="dashboardMap">
		

SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!-- 	 		, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4 -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
				WHERE A.DIS_CLASS_DTL = #{classCdDtl}
				GROUP BY 
					A.PROTOCOL
					,A.CLASS_CD_DTL_NM
					,A.STATUS
					,A.SEX
					,A.PERFORM_CNT
			)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'M'
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!--  			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4  -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}		
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!-- 	 		, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S4PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S3PC2
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), '.') USING UTF8) AS S2PC2
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S4PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S3PC3
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), '.') USING UTF8) AS S2PC3
			
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S4PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S3PC4
			, CONVERT (IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), '.') USING UTF8) AS S2PC4  -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
		AND B.PERFORM_CNT NOT IN (2, 3, 4)
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!-- 	 		, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
			A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!-- 	 		, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4  -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!-- 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4 -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
				,A.DIS_CLASS_DTL
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
			A.PROTOCOL
			,A.CLASS_CD_DTL_NM
			,A.STATUS
			,A.SEX
			,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
 <!-- 			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4  -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!-- 	 		, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4  -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!-- 	 		, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4  -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
			,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
		
		UNION
		
		SELECT 
			IF(COUNT(B.CLASS_CD_DTL_NM) > 0, CASE WHEN B.DIS_CLASS_DTL = 'DS001' THEN 'TIC군 총합'
											WHEN B.DIS_CLASS_DTL = 'DS003' THEN 'ASD군 총합' END, CASE WHEN B.DIS_CLASS_DTL = 'DS001' THEN 'TIC군 총합'
											WHEN B.DIS_CLASS_DTL = 'DS003' THEN 'ASD군 총합' END) CLASS_CD_DTL_NM_NO
			, IF(COUNT(B.SEX) > 0, '셀삭제', '셀삭제') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S3PC1
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 1, ACOUNT, NULL)), 0) AS S2PC1
			
<!--  			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S4PC2
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S3PC2
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 2, ACOUNT, NULL)), 0) AS S2PC2
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S4PC3
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S3PC3
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 3, ACOUNT, NULL)), 0) AS S2PC3
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S4PC4
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S3PC4
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = 4, ACOUNT, NULL)), 0) AS S2PC4  -->
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
			)B
			GROUP BY B.DIS_CLASS_DTL
	</select>
	
	<select id="selectDashboardListVcnt" parameterType="map" resultMap="dashboardMap">
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM_NO	
            , CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX_NO
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
				WHERE A.DIS_CLASS_DTL = #{classCdDtl}
				GROUP BY 
					A.PROTOCOL
					,A.CLASS_CD_DTL_NM
					,A.STATUS
					,A.SEX
					,A.PERFORM_CNT
			)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'M'
            

		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM_NO		
            , CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX_NO
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '비약물군'
			AND B.PERFORM_CNT NOT IN (2, 3, 4)
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '비약물군') AS CLASS_CD_DTL_NM_NO
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
		B.CLASS_CD_DTL_NM = '비약물군'
		AND B.PERFORM_CNT NOT IN (2, 3, 4)
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM_NO
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX_NO
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}			
			GROUP BY 
			A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM_NO
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX_NO
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '단기약물치료군') AS CLASS_CD_DTL_NM_NO
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
			A.PROTOCOL
			,A.CLASS_CD_DTL_NM
			,A.STATUS
			,A.SEX
			,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '단기약물치료군'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM_NO
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '남' END SEX_NO
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'M'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM_NO
			, CASE B.SEX WHEN 'F' THEN '여' WHEN 'M' THEN '남' ELSE '여' END SEX_NO
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
			AND B.SEX = 'F'
		
		UNION
		
		SELECT 
			IFNULL(B.CLASS_CD_DTL_NM, '장기약물노출군') AS CLASS_CD_DTL_NM_NO
			, IF(COUNT(B.SEX) > 0, '총합', '총합') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
			,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
		)B
		WHERE 
			B.CLASS_CD_DTL_NM = '장기약물노출군'
		
		UNION
		
		SELECT 
			IF(COUNT(B.CLASS_CD_DTL_NM) > 0, CASE WHEN B.DIS_CLASS_DTL = 'DS001' THEN 'TIC군 총합'
											WHEN B.DIS_CLASS_DTL = 'DS003' THEN 'ASD군 총합' END, CASE WHEN B.DIS_CLASS_DTL = 'DS001' THEN 'TIC군 총합'
											WHEN B.DIS_CLASS_DTL = 'DS003' THEN 'ASD군 총합' END) CLASS_CD_DTL_NM_NO
			, IF(COUNT(B.SEX) > 0, '셀삭제', '셀삭제') SEX
			
			, IFNULL(SUM(IF(B.STATUS = '0004' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S4PC5
			, IFNULL(SUM(IF(B.STATUS = '0003' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S3PC5
			, IFNULL(SUM(IF(B.STATUS = '0002' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S2PC5
			, IFNULL(SUM(IF(B.STATUS = '0001' AND B.PERFORM_CNT = ${performCnt}, ACOUNT, NULL)), 0) AS S1PC5
		
		FROM (
			SELECT
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.DIS_CLASS_DTL
				,A.PERFORM_CNT
				,COUNT(*) AS ACOUNT
			FROM (
				SELECT 
					TM.PROTOCOL
					,CD.CLASS_CD_DTL_NM
					,PM.STATUS
					,TM.SEX
					,TM.DIS_CLASS_DTL
					,PM.PERFORM_CNT
				FROM T_TARGET_MST TM
				JOIN T_PERFORM_MST PM
					ON TM.TARGET_ID = PM.TARGET_ID
					AND TM.USE_YN = 'Y'
					AND TM.DIS_CLASS_DTL = PM.DIS_CLASS_DTL
					AND TM.RND_ID = 1
				JOIN T_CODE_DTL CD
					ON TM.PROTOCOL = CD.CLASS_CD_DTL) A
			WHERE A.DIS_CLASS_DTL = #{classCdDtl}
			GROUP BY 
				A.PROTOCOL
				,A.CLASS_CD_DTL_NM
				,A.STATUS
				,A.SEX
				,A.PERFORM_CNT
			)B
			GROUP BY B.DIS_CLASS_DTL
	</select>
	

</mapper>
		
